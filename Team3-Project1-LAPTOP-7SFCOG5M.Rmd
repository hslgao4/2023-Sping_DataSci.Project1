---
title: "The Impact of COVID-19 Lockdown on Robbery Rates: An Exploratory Data Analysis (EDA) of Criminal Activity in Washington D.C."
author: "Muhannad Alwhebie, Liang Gao, Nammin Woo"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=F}
#nammin revise: add library options
library(ezids)
library(readr) #install & load 
library(ggplot2)
library(DBI) #SQL
library(magrittr)
library(dplyr)  #for data manipulation.
library(tidyr) #for data tidying.
library(tidyverse)
library(graphics) 
library(gridExtra) #graph arrange(positioning)
```

# The Effect of COVID-19 Lockdown on Robbery Incidents in Washington D.C.

## Abstract

This abstract summarizes an exploratory data analysis (EDA) project that examines the impact of the COVID-19 lockdown on robbery rates in Washington D.C using a dataset of roughly 8000 observations. The study analyzes the pre-pandemic, lockdown, and post-pandemic periods to determine significant changes in robbery frequency. The project explores differences in robbery patterns during the pandemic compared to pre/post-pandemic times, investigates changes in the relationship between the day of the week and the frequency of robberies before and after the pandemic period, examines changes in the relationship between the day of the month and the frequency of robberies before and after the pandemic period, and identifies significant changes in the frequency of robberies among districts before and after the pandemic. The study supports the findings of the Boman and Gallupe (2020) study that violent crime increased during the lockdown period. Furthermore, the EDA found that robbery frequency changed throughout the pandemic, and there may be underlying socio-economic factors contributing to the change in robbery patterns. Additionally, the number of robberies in Autumn dramatically increased during the lockdown period. Overall, the analysis provides insight into how the COVID-19 pandemic has affected crime patterns in Washington D.C and may inform future policy decisions related to crime prevention and public safety.

## Introduction

The COVID-19 pandemic has impacted various aspects of daily life, including crime rates. This EDA project examines the impact of the COVID-19 lockdown on robbery rates in Washington D.C. The study analyzes the pre-pandemic, lockdown, and post-pandemic periods (2019-2022) to determine significant changes in robbery frequency. Robbery is defined by the Code of the District of Columbia as taking anything of value from the person or immediate actual possession of another by force or violence, putting in fear, or by sudden or stealthy seizure or snatching. 

**SMART questions**

 + The project explores differences in robbery patterns during the pandemic compared to pre/post-pandemic times. 
 + It also investigates changes in the relationship between the day of the week and the frequency of robberies before and after the pandemic period. 
 + Additionally, the project examines changes in the relationship between the day of the month and the frequency of robberies before and after the pandemic period. 
 + Finally, the study identifies significant changes in the frequency of robberies among districts before and after the pandemic.

The study by Boman and Gallupe (2020), suggests that the COVID-19 pandemic and the associated mandatory stay-at-home orders have had a differential impact on crime rates in the US. While overall crime rates, as measured by calls for service to law enforcement, have decreased compared to the pre-pandemic year of 2019, this drop appears to be driven by decreases in minor offenses that are typically committed in peer groups. In contrast, serious crimes that are generally not committed with co-offenders, such as homicide and intimate partner violence, have either remained constant or increased. The study raises the possibility that mandatory lockdown orders may have displaced minor offenders into situations where there is a greater opportunity for serious crimes, particularly intimate partner violence and homicide.


Prior to the pandemic. According to the Metropolitan Police Department's crime statistics, the overall crime rate in Washington D.C. has been decreasing in recent years. In 2019, there were 31,700 reported incidents of crime, a decrease from 37,265 in 2016. However, within this overall trend, there have been fluctuations in specific types of crimes, including robbery. Moreover, Robbery has been a persistent problem in Washington D.C., particularly in certain areas of the city. In 2019, there were 2,700 reported incidents of robbery, down from 2,977 in 2015. As such, it is important to examine how the COVID-19 pandemic and associated lockdown measures have impacted robbery rates in the city. This analysis will provide insight into how the pandemic has affected crime patterns in a major urban area and may inform future policy decisions related to crime prevention and public safety.



```{r setup, include=FALSE}
#nammin revise: knitr::opts_chunk$set(echo = TRUE) > combined as following
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
options(scipen=9999, digits = 3) 
#options(scientific=T, digits = 3) 
#options(scipen = 9999) # suppress scientific notation
```

## Methodology

### 1. Data  
The dataset we used contains detailed information on robbery incidents that occurred between 2019 and 2022 ("Robbery_DC_clean.csv)."


### 2. Data Wrangling and Preprocessing

```{r}
#Import
Robbery = data.frame(read.csv("Robbery_DC_clean.csv"))

#Import
#str(Robbery)  
```


*Create Clarence_Rate* 

We created a new column called "Clearance Rate." This column takes into account the time between the start and end dates of each robbery incident and indicates whether the crime was cleared by the police during that time period. This allows us to measure both the difficulty of the crime and the performance of the police in solving these crimes. By examining the clearance rate of robbery incidents, we can gain insight into how effective law enforcement is at addressing and preventing robbery in the area of study. Additionally, this information can be used to identify trends and patterns in the clearance rate over time and potentially inform policy decisions related to crime prevention and law enforcement strategies.

*Clearance_rate(Unit: Minute)= END_DATE - START_DATE*

```{r}
#1. Make a new variable: create Clearance_rate(Unit: Minute)= END_DATE - START_DATE 

#A. 'Date' format 

Robbery$START_DATE_2 <- as.POSIXct(Robbery$START_DATE,format = "%Y/%m/%d %H:%M:%S")
Robbery$END_DATE_2 <- as.POSIXct(Robbery$END_DATE,format = "%Y/%m/%d %H:%M:%S")

#B. Change variable format
Robbery$Clearance_rate <- as.numeric(difftime(strptime(Robbery$END_DATE_2,"%Y-%m-%d%H:%M:%S"),strptime(Robbery$START_DATE_2,"%Y-%m-%d %H:%M:%S")))/60 

Robbery$Clearance_rate <- format(round(Robbery$Clearance_rate, 0), nsmall = 0)
Robbery$Clearance_rate<- as.integer(Robbery$Clearance_rate)

#2. Organize columns, data final check

#head(select(Robbery,START_DATE, START_DATE_2, END_DATE_2,Clearance_rate),5)
#strptime(paste(Robbery$START_DATE, Robbery$END_DATE), "%Y-%m-%d")  #%H:%M

#A. column remove
Robbery <- select(Robbery,-Robbery_Time, -START_DATE, -END_DATE)
#as.numeric(difftime(strptime(END_DATE_2,"%Y-%m-%d%H:%M:%S"),strptime(START_DATE_2,"%Y-%m-%d %H:%M:%S"))) 

#B. rename
Robbery <-rename(Robbery, START_DATE = START_DATE_2)
Robbery <-rename(Robbery, END_DATE = END_DATE_2)  

#C. change datatypes of Char.var for EDA (as Factor)
cols <- c('Period_cat','Period_cat_2','Month_2','Month_3','Season','Date_cat','Day_cat_2','SHIFT','METHOD')

Robbery %<>%
       mutate_each_(funs(factor(.)),cols)

#D. column order define (for chart)
#Category var. label order fix
Robbery$Period_cat <- factor(Robbery$Period_cat, levels=c("Pre", "Lock", "Post"))

Robbery$Season <- factor(Robbery$Season, levels=c("SPRING", "SUMMER", "AUTUMN", "WINTER"))
   
#Robbery$SHIFT<- as.factor(Robbery$SHIFT) 
#E. Make subsets
#1. by pandemic phrases
Robbery_pre <- subset(Robbery,subset = Robbery$Period_cat == 'Pre')  #2535
Robbery_lock <- subset(Robbery,subset = Robbery$Period_cat == 'Lock') #2729
Robbery_post <- subset(Robbery,subset = Robbery$Period_cat == 'Post') #3079

#2. by year
Robbery_2019 <- subset(Robbery,subset = Robbery$Year == 2019)  #2574
Robbery_2020 <- subset(Robbery,subset = Robbery$Year == 2020) #2648
Robbery_2021 <- subset(Robbery,subset = Robbery$Year == 2021)
Robbery_2022 <- subset(Robbery,subset = Robbery$Year == 2022)

```


*The variables in the dataset are:*

```{r}
str(Robbery)

#colnames(Robbery)
#ncol(Robbery)
#nrow(Robbery)
```

```{r}
xkabledply(Robbery[1:4,], title = "The first 4 rows of the dataframe are")

```


```{r}
xkabledply(Robbery[(nrow(Robbery)-3):nrow(Robbery),], title = "The last 4 rows of the dataframe are")
```

The dataset consists of *8343* observations and *22* variables, including:

* `OBJECTID`: a unique identifier for each robbery incident
* `Seq`: a sequential number for each robbery incident
* `OFFENSE`: the type of offense, which is always "ROBBERY" in this dataset
* `REPORT_DAT`: the date and time the robbery incident was reported
* `REPORT_DAT_2`: the date the robbery incident was reported
* `Period_cat`: a categorical variable indicating whether the robbery occurred before, during, or after the COVID-19 lockdown period
* `Period_cat_2`: similar to `Period_cat` (divide 2 specific groups in before lockdown period)
* `Year`: the year the robbery incident occurred
* `Month`: the month the robbery incident occurred (Transformed: Month_2, Month_3)
* `Season`: the season in which the robbery incident occurred
* `Date`: the day of the month the robbery incident occurred
* `Date_cat`: a categorical variable indicating whether the robbery incident occurred at the beginning, middle, or end of the month
* `Time_hour`: the hour of the day the robbery incident occurred
* `SHIFT`: a categorical variable indicating the shift during which the robbery incident occurred, which can be "DAY," "EVENING," or "NIGHT"
* `Day_cat`: the day of the week the robbery incident occurred, represented as an integer
* `Day_cat_2`: a categorical variable indicating whether the robbery incident occurred on a weekday or weekend
* `METHOD`: a categorical variable indicating the method used in the robbery, which can be "GUN," "KNIFE," or "OTHER"
* `DISTRICT`: the police district where the robbery incident occurred, represented as an integer
* `PSA`: the police service area where the robbery incident occurred, represented as an integer
* `START_DATE`: the date and time the robbery incident started
* `END_DATE`: the date and time the robbery incident ended
* `Clearance_rate`: the percentage of robbery incidents that were cleared by the police


## Analysis 


### 1. Summary statistics of robbery incidents in D.C. before, during the COVID-19 lockdown and post

```{r}
#Summary
#columns to analyse 
cols <- c('Period_cat','Period_cat_2','Year', 'Month',
          'Season','Date_cat','Date',
          'SHIFT','Time_hour','Clearance_rate','Day_cat','Day_cat_2',
          'METHOD','DISTRICT','PSA')

knitr::kable(summary(select(Robbery,cols)), format = "markdown", caption="Overall summary statistics of Robbery between 2019 to 2022 in D.C")

#Freq
#Robbery %>%  
#  count(Clearance_rate)

#Where
#Robbery |>   
#  filter(Clearance_rate > 1440)  # more that one-day

```

Key statistics of individual Quantitative variable are:

   + `Month`: Mean(`r mean(Robbery$Month,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Month, na.rm = TRUE)`), Variance(`r var(Robbery$Month, na.rm = TRUE)`)
   
```{r, results='hide'}
mean(Robbery$Month,na.rm = TRUE)
sd(Robbery$Month, na.rm = TRUE)
var(Robbery$Month, na.rm = TRUE)
```

   + `Date`: Mean(`r mean(Robbery$Date,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Date, na.rm = TRUE)`), Variance(`r var(Robbery$Date, na.rm = TRUE)`)
   
```{r, results='hide'}
mean(Robbery$Date,na.rm = TRUE)
sd(Robbery$Date, na.rm = TRUE)
var(Robbery$Date, na.rm = TRUE)
```

   + **`Day_cat`** (Sun= 1, Mon:2, Tue:3, Wed:4, Thr:5, Fri: 6, Sat: 7): Mean(`r mean(Robbery$Day_cat,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Day_cat, na.rm = TRUE)`), Variance(`r var(Robbery$Day_cat, na.rm = TRUE)`)
   
```{r, results='hide'}
mean(Robbery$Day_cat,na.rm = TRUE)
sd(Robbery$Day_cat, na.rm = TRUE)
var(Robbery$Day_cat, na.rm = TRUE)
```
   + **`Time_hour`**
   1. Mean(`r mean(Robbery$Time_hour,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Time_hour, na.rm = TRUE)`), Variance(`r var(Robbery$Time_hour, na.rm = TRUE)`)
   
   2. AM7~12: 1568, PM 12~18: 1114, 18~23:1937, **0~7: 3724**(`r round(3724/8343*100,0)`)%,

     
```{r, results='hide'}
mean(Robbery$Time_hour,na.rm = TRUE)
sd(Robbery$Time_hour, na.rm = TRUE)
var(Robbery$Time_hour, na.rm = TRUE)

# 7~12: 1568, 12~18: 1114, 18~24:1937, 0~7: 3724,
#Robbery |>   
#  filter(Time_hour>=0,Time_hour<7)  

#Robbery |>   
# filter(Time_hour>=18,Time_hour<24)  

```


   + **`Clearance_rate`** (Minute, `END_DATE` - `START_DATE`, )
   
   1. Mean(`r mean(Robbery$Clearance_rate,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Clearance_rate, na.rm = TRUE)`), Variance(`r var(Robbery$Clearance_rate, na.rm = TRUE)`)
   
   2. Freq: more than 1 hour is **2599**(`r round(2599/8343*100,0)`%) 
      
```{r, results='hide'}
mean(Robbery$Clearance_rate,na.rm = TRUE)
sd(Robbery$Clearance_rate, na.rm = TRUE)
var(Robbery$Clearance_rate, na.rm = TRUE)

# more that 1 hours: 2,599
#Robbery |>   
#  filter(Clearance_rate > 60)  
```


   + **`DISTRICT`**: Mean(`r mean(Robbery$DISTRICT,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$DISTRICT, na.rm = TRUE)`), Variance(`r var(Robbery$DISTRICT, na.rm = TRUE)`)
   
```{r, results='hide'}
mean(Robbery$DISTRICT,na.rm = TRUE)
sd(Robbery$DISTRICT, na.rm = TRUE)
var(Robbery$DISTRICT, na.rm = TRUE)

#Time_hour Clearance_rate PSA
```
   
   + **`PSA`**: Mean(`r mean(Robbery$PSA,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$PSA, na.rm = TRUE)`), Variance(`r var(Robbery$PSA, na.rm = TRUE)`)
   
```{r, results='hide'}
mean(Robbery$PSA,na.rm = TRUE)
sd(Robbery$PSA, na.rm = TRUE)
var(Robbery$PSA, na.rm = TRUE)
```

Based on the summary statistics of the robbery data between 2019 to 2022 in D.C., we can observe the following:

There were a total of 8,343 robbery incidents during the period, with 2,535 incidents recorded in the pre-lockdown period and 3,079 incidents in the post-lockdown period.
The robbery incidents were evenly distributed across different seasons, with the highest number of incidents recorded in the spring (1,585) and the lowest in winter (2,073).
The majority of robbery incidents occurred during the evening shift (3,305) and midnight shift (3,381), with very few incidents during the day shift (1,657).
The most common method used in robbery incidents was with a gun (4,031 incidents), followed by other methods (3,804 incidents) and with a knife (508 incidents).
The districts with the highest number of robbery incidents were 4 (1,379 incidents), 7 (1,224 incidents), and 6 (1,163 incidents), while the PSA with the highest number of incidents was PSA 708 (599 incidents).
The mean clearance rate for robbery incidents was 215 minutes, which indicates that it took about 3 hours to clear the incidents (an arrest or closure).
There were some missing values in the data set, with 1701 instances of "NA" recorded in the "Clearance_rate" column, which means the proportion uncleared robbery incidents that have no value of clearance rate is about 21%. And 21 and 22 instances of "NA" recorded in the "DISTRICT" and "PSA" columns, respectively.

### 2. Exploratory plots of robbery incidents in D.C. before, during the COVID-19 lockdown and post

Period_cat | Define | Description   
-----|-------|-----------  
 Pre   | Pre-pandemic (14M)   |  2019.1.1 ~2020.2.29   
Lock   | Lockdown(17M)   | 2020.3.1~ 2021. 7.31    
Post   |   Post-pandemic(17M)   | 2021.8.1~2022.12.31 

During pre-pandemic period, people were living their lives as usual, with no significant disruptions caused by the pandemic.

During the lockdown, the government implemented several measures to curb the spread of the virus, including banning gatherings of 50 or more people, cutting restaurant dining room capacity in half, disallowing bar and standing service for social distancing, and closing nightclubs.During this time, people were confined to their homes, and many businesses were closed, resulting in a significant impact on daily life.

During the post-pandemic, people were slowly returning to their daily routines, with businesses reopening, and social interactions resuming to some degree. However, there was still a need to take precautions, such as wearing masks, and social distancing, due to the continued threat of the pandemic.


**1. Basic plots of Robbery data is below:**

   + Chart A1 describes the Robbery frequency by 4 years ('19~'22).
   + Charts A2 show the total number of robberies per month over a four-year period from 2019 to 2022. The x-axis represents the months and years, while the y-axis represents the number of robberies. Each point on the line represents the total number of robberies in a given month and year.
   + Chart A3 shows the Robbery frequency by pandemic phrases (Pre: 14 Month, Lock-down: 17 Month, Post: 17 Month), Chart A4 reveals the average number of robberies per month by phrases.

```{r}
# Plot 1.: Freq by yeqr (x:discrete, Barchart)+Value=count(freq)

plot_year <- ggplot(data=Robbery, aes(x=Year)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + 
  labs(x="Year", y="Frequency") + labs(title="A1.Yearly Robbery Frequency")

# Plot 2.: Freq by Month (x:continuous, Histogram)+Value=count(freq)

plot_Month <- ggplot(data=Robbery, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2.Monthly Robbery Frequency") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

# Plot 3.: Freq by Period phase(Pre,lockdown,post)+Value=count(freq)

plot_Period <- ggplot(data=Robbery, aes(x=Period_cat)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..), vjust = 1.5) + 
  labs(x="Phase", y="Frequency") + labs(title="A3.Robbery by Pandemic phase 
(Month: Pre=14, Lock=17, Post=17)") 

# Plot 4. average Robbery frequency per month [by Period_cat]+Value
temp <- count(Robbery,Period_cat, sort=TRUE)

#Avg
temp[1,3] = as.integer(temp[1,2] / 17 ) #post: 17M  
temp[2,3] = as.integer(temp[2,2] / 17) #lock: 17M  
temp[3,3] = as.integer(temp[3,2] / 14) #pre: 14M 

x <-  c("Pre","Lock","Post")
y  <-  c(temp[3,3],temp[2,3],temp[1,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Period_mon <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Phase", y="Avg.Robbery") +
  labs(title="A4.Avg.Robbery(per month)") + scale_x_discrete(limits=c("Pre","Lock","Post")) + geom_text(aes(label=signif(y)),vjust = 1.5)   

grid.arrange(plot_year,plot_Month,plot_Period,plot_Period_mon, ncol=2, nrow=2)

# Plot 2.: Freq by yeqr (x:discrete, Barchart)+Value=percent of freq
#plot_year_pct <- ggplot(data=Robbery, aes(x=Year, #y=..count../sum(..count..)*100)) +
#geom_bar(colour="darkblue", fill="lightblue",alpha = .7) + #geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="Year", #y="Percent(%)") + labs(title="A1.Yearly Robbery Frequency(%)")

#plot_Month_pct <- ggplot(Robbery, aes(x = Month)) +
#  geom_histogram(aes(y = after_stat(count / sum(count))), col="darkblue", 
#                 fill="lightblue", 
#                 alpha = .7) +
#  stat_bin(
#    binwidth = 1,geom = "text", color = "black",
#    aes(y = after_stat(count / sum(count)), 
#        label = scales::percent(after_stat(round(count / sum(count), 2)))),
#    position = position_stack(vjust = 1)
#  ) +
#  scale_y_continuous(labels = scales::percent)+ scale_x_continuous(breaks=1:12) + 
#  labs(x="Month", y="Percent(%)",title="A2.Monthly Robbery Frequency(%)")

```

Overall, the data seems to show an increasing trend over the years, with the highest count in 2022. Within each year, there are variations in the count of data points, with the highest count in October and the lowest count in March for each year.

A3 shows the number of robbery incidents that occurred during each of the pandemic phases.

A4 shows the average number of robbery incidents per month during each pandemic phase. 

Overall, the data shows that there was an increase in the number of robbery incidents during the lock-down phase compared to the pre-pandemic phase. However, the number of robbery incidents during the post-pandemic phase was higher than both the pre-pandemic and lock-down phases. **The average number of robbery incidents per month remained relatively stable during the pre-pandemic and post-pandemic phases, but decreased during the lock-down phase.**

**2-1.Freq by Month :split by pandemic phrases**

  + Chart A2-2~A2-4 show the Monthly Robbery frequency by pandemic phrases.  

```{r}
# Plot.Freq by Month :split by pandemic phrase

#pre
plot_Month_pre <- ggplot(data=Robbery_pre, aes(x=Month_3)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.4) + #vjust:lable position
  labs(x="Month") + labs(title="A2-2.Monthly Robbery (Pre: 14M)")

#lock
plot_Month_lock <- ggplot(data=Robbery_lock, aes(x=Month_3)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.4) + #vjust:lable position
  labs(x="Month") + labs(title="A2-3.Monthly Robbery (Lock: 17M)") + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

#post
plot_Month_post <- ggplot(data=Robbery_post, aes(x=Month_3)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.4) + #vjust:lable position
  labs(x="Month") + labs(title="A2-4.Monthly Robbery (Post: 17M)") + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

grid.arrange(plot_Month_pre, plot_Month_lock,plot_Month_post, ncol=1, nrow=3)

```

The monthly robbery frequency during the pre-pandemic period ranged from 126 to 230 incidents, with an average of 181 incidents per month. During the lockdown period, it ranged from 87 to 258 incidents, with an average of 160 incidents per month. Finally, during the post-pandemic period,  it ranged from 131 to 260 incidents, with an average of 181 incidents per month.


**2-2. Freq by Month :split by Years**

  + Chart A2-5~A2-8 display the number of robberies per month and year. 

```{r}
# Plot.Freq by Month :split by pandemic phrase

plot_Month_2019 <- ggplot(data=Robbery_2019, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2-5.Monthly Robbery(2019)") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 


plot_Month_2020 <- ggplot(data=Robbery_2020, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2-6.Monthly Robbery(2020)") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

plot_Month_2021 <- ggplot(data=Robbery_2021, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2-7.Monthly Robbery(2021)") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

plot_Month_2022 <- ggplot(data=Robbery_2022, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2-8.Monthly Robbery(2022)") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

grid.arrange(plot_Month_2019, plot_Month_2020,plot_Month_2021, plot_Month_2022, ncol=2, nrow=2)

```


In 2019, the number of robberies increased from January to October, with the highest number of robberies occurring in October at 230. The number of robberies then decreased in the following months of the year. In 2020, the number of robberies remained relatively stable until August, after which it began to increase, peaking in October at 258. In 2021, the number of robberies continued to rise from August to October, with the highest number of robberies occurring in October at 220. The number of robberies decreased in November and December of the same year.

Overall, the bar charts reveal an increasing trend in the number of robberies from 2019 to 2020, with October being the peak month for both years. Although the number of robberies decreased in 2021, it still remained relatively high compared to the beginning of the time period. 

**3-1. Freq by Season :split by pandemic phrases (Avg.Robbery(per month)**
  
  + Season: Spring, Summer, Autumn, and Winter. 

```{r}
# Number of months per each season of pandemic phrases    
#      pre	lock	post  total
#spring	3	   6	  3     12
#sum   	3	   5	  4     12
#fall 	3	   3	  6     12
#winter	5	   3	  4     12
#	     14	  17	 17     48

#Total
temp <- count(Robbery,Season, sort=FALSE) #spring, summer,AUTUMN, winter, 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 12) #spring 
temp[2,3] = as.integer(temp[2,2] / 12) #summer
temp[3,3] = as.integer(temp[3,2] / 12) #AUTUMN 
temp[4,3] = as.integer(temp[4,2] / 12) #winter 

x <-  c("SPRING","SUMMER","AUTUMN","WINTER")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Season <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="B1.Seanson_Rob_freq.(Month mean)") + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) + geom_text(aes(label=signif(y)),vjust = 1.5)   

#########Pre
temp <- count(Robbery_pre,Season, sort=FALSE) 

#pre-pen
temp[1,3] = as.integer(temp[1,2] / 3) # spring 
temp[2,3] = as.integer(temp[2,2] / 3) # summer
temp[3,3] = as.integer(temp[3,2] / 3) # AUTUMN
temp[4,3] = as.integer(temp[4,2] / 5) # winter

x <-  c("SPRING","SUMMER","AUTUMN","WINTER")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Season_pre <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="B1_1.Pre_Season_Rob./M") + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) + geom_text(aes(label=signif(y)),vjust = 1.5)   


######Lock
temp <- count(Robbery_lock,Season, sort=FALSE) 

#lock-pen
temp[1,3] = as.integer(temp[1,2] / 6) # spring 
temp[2,3] = as.integer(temp[2,2] / 5) # summer
temp[3,3] = as.integer(temp[3,2] / 3) # AUTUMN
temp[4,3] = as.integer(temp[4,2] / 3) # winter

x <-  c("SPRING","SUMMER","AUTUMN","WINTER")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Season_lock <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="B1_2.Lock_Season_Rob./M") + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) + geom_text(aes(label=signif(y)),vjust = 1.5)   

#########Post
temp <- count(Robbery_post,Season, sort=FALSE) #fall, summer, winter, spring

#post-pen
temp[1,3] = as.integer(temp[1,2] / 3) # spring 
temp[2,3] = as.integer(temp[2,2] / 4) # summer
temp[3,3] = as.integer(temp[3,2] / 6) # AUTUMN
temp[4,3] = as.integer(temp[4,2] / 4) # winter

x <-  c("SPRING","SUMMER","AUTUMN","WINTER")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Season_post <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="B1_3.Post_Season_Rob./M") + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) + geom_text(aes(label=signif(y)),vjust = 1.5) 

grid.arrange(plot_Season, plot_Season_pre, plot_Season_lock, plot_Season_post,
             ncol=2, nrow=2)

```

Chart B1 shows the average number of robberies per month in each season. Spring and winter have the lowest average number of robberies, with 132 and 172 respectively, while summer and autumn have the highest averages, with 186 and 204 respectively.

Chart B1_1 is for pre-pandemic. The pattern is similar to Chart B1, with summer and autumn having the highest averages, but with slightly higher numbers overall. Spring and winter also have slightly higher averages, with 156 and 154 respectively.

Chart B1_2 is for lockdown. Interestingly, the number of robberies decreased significantly in spring and summer, with averages of 110 and 183 respectively. However, the number of robberies dramatically increased again in autumn, with an average of 221, and remained high in winter with an average of 160.

Chart B1_3 is for post-pandemic. The number of robberies in summer decreased slightly to an average of 168, while the number of robberies in autumn remained high at an average of 189. The number of robberies in spring increased to an average of 150, while the number of robberies in winter increased significantly to an average of 205.

Overall, the data shows a decrease during the lockdown period and a subsequent increase afterward. The patterns of each season are generally consistent throughout the time period, with summer and autumn having the highest averages.

**3-2. Freq by Season :split by Years**

```{r}
plot_Season_2019 <- ggplot(data=Robbery_2019, aes(x=Season)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) +
  labs(x="Season") + labs(title="B1_4.Seanson_Robbery (2019)")

plot_Season_2020 <- ggplot(data=Robbery_2020, aes(x=Season)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) +
  labs(x="Season") + labs(title="B1_5.Seanson_Robbery (2020)")

plot_Season_2021 <- ggplot(data=Robbery_2021, aes(x=Season)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) +
  labs(x="Season") + labs(title="B1_6.Seanson_Robbery (2021)")

plot_Season_2022 <- ggplot(data=Robbery_2022, aes(x=Season)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) +
  labs(x="Season") + labs(title="B1_7.Seanson_Robbery (2022)")


grid.arrange(plot_Season_2019, plot_Season_2020, plot_Season_2021, plot_Season_2022,
             ncol=2, nrow=2)

```


The four charts, B1_4 to B1_7, display the average number of robberies per month in each season for the years 2019 to 2022. Chart B1_4, which represents 2019, shows that the highest average number of robberies per month was in autumn, with a total of 649 robberies. In contrast, Chart B1_5, which represents 2020, shows that the highest average number of robberies per month was in autumn again, but with a higher total of 665 robberies. Chart B1_6, which represents 2021, shows that the highest average number of robberies per month was in autumn once more, but with a slightly lower total of 628 robberies. Finally, Chart B1_7, which represents 2022, shows that the highest average number of robberies per month was in winter, with a total of 639 robberies.

These charts reveal that the average number of robberies per month varied across different years and seasons. The highest averages were not consistently in the same season or year.

Overall, the data suggests that the pandemic had a significant impact on the average number of robberies per month, particularly during the lockdown period. However, it's important to note that there were also fluctuations in the data across different seasons and years, indicating that other factors may also be contributing to the frequency of robberies.


**4-1. Freq by Date_cat(Begin,Middle,End) :split by pandemic phrases(Avg.Robbery(per month)**

  + In this analysis, the number of robberies is split by date categories: begin(<10), middle(<20), and end(21+) of each month.

```{r}
#Total
temp <- count(Robbery,Date_cat, sort=FALSE) #spring, summer,AUTUMN, winter, 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 48) #Begin 
temp[2,3] = as.integer(temp[2,2] / 48) #End
temp[3,3] = as.integer(temp[3,2] / 48) #Middle 


x <-  c("Begin","Middle","End")
y  <-  c(temp[1,3],temp[3,3],temp[2,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Date_cat <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Date_cat", y="Avg.Robbery") +
  labs(title="C1.Incident Date of Robbery./M") + scale_x_discrete(limits=c("Begin","Middle","End")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Pre
temp <- count(Robbery_pre,Date_cat, sort=FALSE) #spring, summer,AUTUMN, winter, 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 14) #Begin 
temp[2,3] = as.integer(temp[2,2] / 14) #End
temp[3,3] = as.integer(temp[3,2] / 14) #Middle 


x <-  c("Begin","Middle","End")
y  <-  c(temp[1,3],temp[3,3],temp[2,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Date_cat_pre <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Date_cat", y="Avg.Robbery") +
  labs(title="C1_1.Incident Date (Pre)") + scale_x_discrete(limits=c("Begin","Middle","End")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Lock
temp <- count(Robbery_lock,Date_cat, sort=FALSE) #spring, summer,AUTUMN, winter, 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) #Begin 
temp[2,3] = as.integer(temp[2,2] / 17) #End
temp[3,3] = as.integer(temp[3,2] / 17) #Middle 


x <-  c("Begin","Middle","End")
y  <-  c(temp[1,3],temp[3,3],temp[2,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Date_cat_lock <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Date_cat", y="Avg.Robbery") +
  labs(title="C1_2.Incident Date (Lock)") + scale_x_discrete(limits=c("Begin","Middle","End")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Post
temp <- count(Robbery_post,Date_cat, sort=FALSE) #spring, summer,AUTUMN, winter, 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) #Begin 
temp[2,3] = as.integer(temp[2,2] / 17) #End
temp[3,3] = as.integer(temp[3,2] / 17) #Middle 


x <-  c("Begin","Middle","End")
y  <-  c(temp[1,3],temp[3,3],temp[2,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Date_cat_post <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="C1_3.Incident Date (Post)") + scale_x_discrete(limits=c("Begin","Middle","End")) + geom_text(aes(label=signif(y)),vjust = 1.5)

grid.arrange(plot_Date_cat, plot_Date_cat_pre, plot_Date_cat_lock, plot_Date_cat_post,
             ncol=2, nrow=2)


```   

```{r}
prop.1 <- with(Robbery, table(Period_cat, Date_cat)) %>% 
          prop.table(margin = 1)

xkabledply(prop.1*100, title = "Robbery propotion by Date_cat(%)")

```
   
The highest number of robbery incidents occurred during the End category, followed by the Middle category and the Begin category.

 **Interestingly, the number of robbery incidents decreased during the Lockdown phase in all three date categories.** , but it increased again during the Post-pandemic phase.

Overall, it seems that the pandemic has an impact on robbery incidents, with a decrease during the Lockdown phase. And it is also important to note that robbery incidents increased again during the Post-pandemic phase.


**4-2. Boxplot distribution of date :split by pandemic phrases**

```{r}
boxplot_Date <- ggplot(Robbery, aes(y=Date, x=Period_cat, fill=Period_cat)) + 
  geom_boxplot() + 
  geom_boxplot( colour=c("#ff0000","#11cc11","#0000ff"), outlier.shape=8,
                outlier.colour="lightblue", outlier.size=4) +  labs(title="C1_4.Box Pot of Date of Robbery", x="Period", y = "Robbery date") + ylim(0,32)

boxplot_Date 
```


We can see that the distribution of robbery incidents is relatively similar across the different periods. The boxes for each period have similar widths and heights, indicating similar variability and spread of the data within each period.

However, there are some differences in the medians and lower/upper boundaries for each period. For example, the median robbery date for the pre-pandemic period (around June 15th) appears to be slightly earlier than that for the lockdown period (around June 20th), and both of these are earlier than the median date for the post-pandemic period (around June 23rd).

Additionally, the range of robbery dates appears to be slightly wider for the post-pandemic period, with more outliers falling outside the upper boundary of the box compared to the other periods. This suggests that there may have been more variability in the timing of robbery incidents during the post-pandemic period compared to the pre-pandemic and lockdown periodsx-axis represents the different periods.


**5-1. Freq by SHIFT(DAY,EVENING,MIDNIGHT) :split by pandemic phrases(Avg.Robbery(per month)**

  + This section examines the frequency of robberies during different shifts of the day: Day( 09~17), Evening(18~23), and Midnight(00~08). 
  
```{r}
temp <- count(Robbery,SHIFT, sort=FALSE)

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 48) #DAY 
temp[2,3] = as.integer(temp[2,2] / 48) #EVENING
temp[3,3] = as.integer(temp[3,2] / 48) #MIDNIGHT 


x <-  c("DAY","EVENING","MIDNIGHT")
y  <-  c(temp[1,3],temp[2,3],temp[3,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Timezone", y="Avg.Robbery") +
  labs(title="D1.Incident timezone./M") + scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Pre
temp <- count(Robbery_pre,SHIFT, sort=FALSE) 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 14) 
temp[2,3] = as.integer(temp[2,2] / 14) 
temp[3,3] = as.integer(temp[3,2] / 14) 


x <-  c("DAY","EVENING","MIDNIGHT")
y  <-  c(temp[1,3],temp[2,3],temp[3,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_pre <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Timezone", y="Avg.Robbery") +
  labs(title="D1_1.Incident timezone(Pre)") + scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Lock
temp <- count(Robbery_lock,SHIFT, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) 
temp[2,3] = as.integer(temp[2,2] / 17) 
temp[3,3] = as.integer(temp[3,2] / 17)  

x <-  c("DAY","EVENING","MIDNIGHT")
y  <-  c(temp[1,3],temp[2,3],temp[3,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_lock <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Timezone", y="Avg.Robbery") +
  labs(title="D1_2.Incident timezone(Lock)") + scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Post
temp <- count(Robbery_post,SHIFT, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) 
temp[2,3] = as.integer(temp[2,2] / 17) 
temp[3,3] = as.integer(temp[3,2] / 17) 


x <-  c("DAY","EVENING","MIDNIGHT")
y  <-  c(temp[1,3],temp[2,3],temp[3,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_post <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Timezone", y="Avg.Robbery") +
  labs(title="D1_3.Incident timezone(Post)") + scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) + geom_text(aes(label=signif(y)),vjust = 1.5)


grid.arrange(plot_shift, plot_shift_pre, plot_shift_lock, plot_shift_post,
             ncol=2, nrow=2)
```  

D1 shows the number of robberies was highest during the Midnight shift, with 70 incidents reported, followed by 68 in the Evening and 34 during the Day shift. During the Pre-pandemic phase, the highest number of robberies occurred during the Midnight shift, with 74 incidents, also in the Lockdown phase, the Midnight shift had the highest number of robberies, with 66 incidents. In the Post-pandemic phase, the Evening shift had the highest number of robberies, with 72 incidents reported with a decrease in Midnight shift.

This analysis can help in identifying the high-risk periods for robbery and can assist law enforcement agencies in allocating resources to ensure public safety. It can also help in understanding the impact of pandemic phases on the incidence of robbery at different times of the day.


```{r}
prop.1 <- with(Robbery, table(Period_cat, SHIFT)) %>% 
          prop.table(margin = 1)

xkabledply(prop.1*100, title = "Robbery propotion by SHIFT(%)")

```

The analysis of the data shows that during the day time, the percentage of robberies was consistent at around 20% across all three periods: pre-pandemic, lockdown, and post-pandemic. However, in the evening and midnight time periods, the percentage of robberies was consistently higher, at almost 40% for each period.

For the pre-pandemic period specifically, the percentage of robberies that occurred in the day time period was approximately 18%, which increased slightly to 21% in the post-pandemic period. The percentage of robberies that occurred in the midnight time period remained relatively constant, at approximately 42% in the pre-pandemic and lockdown periods, but decreased to 38% in the post-pandemic period.


**6-1. Freq by Day_cat (Sun~Sat) :split by pandemic phrases(Avg.Robbery(per month)**
 
  + This section presents a frequency analysis of robbery incidents by day of the week
  + The days of the week are categorized as Sunday to Saturday. 


```{r}

temp <- count(Robbery,Day_cat, sort=FALSE)

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 48) #SUN
temp[2,3] = as.integer(temp[2,2] / 48) #
temp[3,3] = as.integer(temp[3,2] / 48) #
temp[4,3] = as.integer(temp[4,2] / 48) #
temp[5,3] = as.integer(temp[5,2] / 48) #
temp[6,3] = as.integer(temp[6,2] / 48) #
temp[7,3] = as.integer(temp[7,2] / 48) #SAT

x <-  c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3],temp[5,3],temp[6,3],temp[7,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Day", y="Avg.Robbery") +
  labs(title="E1.Incident Day of Robbery./M") + scale_x_discrete(limits=c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Pre
temp <- count(Robbery_pre,Day_cat, sort=FALSE) 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 14) #SUN
temp[2,3] = as.integer(temp[2,2] / 14) #
temp[3,3] = as.integer(temp[3,2] / 14) #
temp[4,3] = as.integer(temp[4,2] / 14) #
temp[5,3] = as.integer(temp[5,2] / 14) #
temp[6,3] = as.integer(temp[6,2] / 14) #
temp[7,3] = as.integer(temp[7,2] / 14) #SAT

x <-  c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3],temp[5,3],temp[6,3],temp[7,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_pre <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Day", y="Avg.Robbery") +
  labs(title="E1_1.Incident Day of Robbery(Pre)") + scale_x_discrete(limits=c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Lock
temp <- count(Robbery_lock,Day_cat, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) #SUN
temp[2,3] = as.integer(temp[2,2] / 17) #
temp[3,3] = as.integer(temp[3,2] / 17) #
temp[4,3] = as.integer(temp[4,2] / 17) #
temp[5,3] = as.integer(temp[5,2] / 17) #
temp[6,3] = as.integer(temp[6,2] / 17) #
temp[7,3] = as.integer(temp[7,2] / 17) #SAT

x <-  c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3],temp[5,3],temp[6,3],temp[7,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_lock <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Day", y="Avg.Robbery") +
  labs(title="E1_2.Incident Day of Robbery(Lock)") + scale_x_discrete(limits=c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Post
temp <- count(Robbery_post,Day_cat, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) #SUN
temp[2,3] = as.integer(temp[2,2] / 17) #
temp[3,3] = as.integer(temp[3,2] / 17) #
temp[4,3] = as.integer(temp[4,2] / 17) #
temp[5,3] = as.integer(temp[5,2] / 17) #
temp[6,3] = as.integer(temp[6,2] / 17) #
temp[7,3] = as.integer(temp[7,2] / 17) #SAT

x <-  c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3],temp[5,3],temp[6,3],temp[7,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_post <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Day", y="Avg.Robbery") +
  labs(title="E1_3.Incident Day of Robbery(Post)") + scale_x_discrete(limits=c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")) + geom_text(aes(label=signif(y)),vjust = 1.5)


grid.arrange(plot_shift, plot_shift_pre, plot_shift_lock, plot_shift_post,
             ncol=2, nrow=2)

```


We can see that Saturday and Sunday had the highest frequency of robberies, with 27 incidents reported, The remaining days had frequencies that were relatively close to each other.

In the pre-pandemic period, the distribution among the days of the week was more even, with Saturday having the highest frequency of 28 incidents, and Tuesday having the lowest frequency of 23 incidents.

During the lockdown period, the frequency of robberies was lower compared to the overall period, with Sunday having the highest frequency of 26 incidents, and Thursday and Friday having the lowest frequency of 20 incidents.

In the post-pandemic period, the frequency of robberies continued to increase compared to the previous period, with Weekend having the highest frequency of 28 incidents and Wednesday having the lowest frequency of 23 incidents.


**7-1. Freq by Day_cat_2 (Week,Weekend) :split by pandemic phrases(Avg.Robbery(per month)**

  + The section 7-1 shows the frequency of robberies based on two categories: weekdays and weekends. 

```{r}
temp <- count(Robbery,Day_cat_2, sort=FALSE)

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 48) 
temp[2,3] = as.integer(temp[2,2] / 48) 

x <-  c("Weekday","Weekend")
y  <-  c(temp[1,3],temp[2,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Day", y="Avg.Robbery") +
  labs(title="F1.Incident Date_2 of Robbery./M") + scale_x_discrete(limits=c("Weekday","Weekend")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Pre
temp <- count(Robbery_pre,Day_cat_2, sort=FALSE) 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 14) 
temp[2,3] = as.integer(temp[2,2] / 14) 

x <-  c("Weekday","Weekend")
y  <-  c(temp[1,3],temp[2,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_pre <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Day", y="Avg.Robbery") +
  labs(title="F1_1.Incident Date_2 (Pre)") + scale_x_discrete(limits=c("Weekday","Weekend")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Lock
temp <- count(Robbery_lock,Day_cat_2, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) 
temp[2,3] = as.integer(temp[2,2] / 17) 

x <-  c("Weekday","Weekend")
y  <-  c(temp[1,3],temp[2,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_lock <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Day", y="Avg.Robbery") +
  labs(title="F1_2.Incident Date_2 (Lock)") + scale_x_discrete(limits=c("Weekday","Weekend")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Post
temp <- count(Robbery_post,Day_cat_2, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) 
temp[2,3] = as.integer(temp[2,2] / 17) 

x <-  c("Weekday","Weekend")
y  <-  c(temp[1,3],temp[2,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_post <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Day", y="Avg.Robbery") +
  labs(title="F1_3.Incident Date_2 of (Post)") + scale_x_discrete(limits=c("Weekday","Weekend")) + geom_text(aes(label=signif(y)),vjust = 1.5)


grid.arrange(plot_shift, plot_shift_pre, plot_shift_lock, plot_shift_post,
             ncol=2, nrow=2)

#prop.1 <- with(Robbery, table(Period_cat, Day_cat_2)) %>% 
#          prop.table(margin = 1)

#xkabledply(prop.1*100, title = "Robbery propotion by Weekday/Weekend(%)")

```


```{r}
prop.1 <- with(Robbery, table(Period_cat, Day_cat_2)) %>% 
          prop.table(margin = 1)

xkabledply(prop.1*100, title = "Robbery propotion by Weekday/Weekend(%)")

```

Overall, the histograms suggest that the pandemic did not have a significant impact on the pattern of robberies on days, the frequency of robberies in weekend remained a high frequency of robberies.(Pre 31.01%, Lock 32.25%, Post 31.21%) 		

**8-1. Freq by METHOD :split by pandemic phrases(Avg.Robbery(per month)**

  + This section presents the frequency of robbery incidents by method, split by pandemic phases. 
  + The data show that **the portion of gun robberies increased significantly from 34.24% in the pre-pandemic period to 51.67% in the lockdown period and further to 56.93% in the post-pandemic period.**
  + This suggests that the use of guns in robberies increased during the pandemic phases.
  + Additionally, the average frequency of gun robberies per month also **increased from 62 in the pre-pandemic period to 82 (a 34% increase) in the lockdown period**, and further to 103 (a 24% increase) in the post-pandemic period. 

```{r}
temp <- count(Robbery,METHOD, sort=FALSE)

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 48) #DAY 
temp[2,3] = as.integer(temp[2,2] / 48) #EVENING
temp[3,3] = as.integer(temp[3,2] / 48) #MIDNIGHT 


x <-  c("GUN","KNIFE","OTHERS")
y  <-  c(temp[1,3],temp[2,3],temp[3,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="METHOD", y="Avg.Robbery") +
  labs(title="G1.Method of Robbery./M") + scale_x_discrete(limits=c("GUN","KNIFE","OTHERS")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Pre
temp <- count(Robbery_pre,METHOD, sort=FALSE) 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 14) 
temp[2,3] = as.integer(temp[2,2] / 14) 
temp[3,3] = as.integer(temp[3,2] / 14) 


x <-  c("GUN","KNIFE","OTHERS")
y  <-  c(temp[1,3],temp[2,3],temp[3,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_pre <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="METHOD", y="Avg.Robbery") +
  labs(title="G1_1.Method of Robbery(Pre)") + scale_x_discrete(limits=c("GUN","KNIFE","OTHERS")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Lock
temp <- count(Robbery_lock,METHOD, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) 
temp[2,3] = as.integer(temp[2,2] / 17) 
temp[3,3] = as.integer(temp[3,2] / 17)  

x <-  c("GUN","KNIFE","OTHERS")
y  <-  c(temp[1,3],temp[2,3],temp[3,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_lock <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="METHOD", y="Avg.Robbery") +
  labs(title="G1_2.Method of Robbery(Lock)") + scale_x_discrete(limits=c("GUN","KNIFE","OTHERS")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Post
temp <- count(Robbery_post,METHOD, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) 
temp[2,3] = as.integer(temp[2,2] / 17) 
temp[3,3] = as.integer(temp[3,2] / 17) 


x <-  c("GUN","KNIFE","OTHERS")
y  <-  c(temp[1,3],temp[2,3],temp[3,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_post <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="METHOD", y="Avg.Robbery") +
  labs(title="G1_3.Method of Robbery(Post)") + scale_x_discrete(limits=c("GUN","KNIFE","OTHERS")) + geom_text(aes(label=signif(y)),vjust = 1.5)


grid.arrange(plot_shift, plot_shift_pre, plot_shift_lock, plot_shift_post,
             ncol=2, nrow=2)
```

The histograms show the frequency of robberies by weapon type, separated by pandemic period. In the overall period, the most common weapon used in robberies was "GUN," with 83 incidents, followed by "OTHERS" with 79 incidents, and "KNIFE" with 10 incidents.

In the pre-pandemic period, the most common weapon used was "OTHERS," with 106 incidents, followed by "GUN" with 62 incidents, and "KNIFE" with 13 incidents. **In the lockdown period, the most common weapon used was changed,"GUN," with 82 incidents,** followed by "OTHERS" with 67 incidents. In the post-pandemic period, the most common weapon used was again "GUN," with 103 incidents, followed by "OTHERS" with 68 incidents, and "KNIFE" with 9 incidents.

Overall, the use of guns in robberies increased from the pre-pandemic period to the lockdown period, and then continued to increase in the post-pandemic period. Additionally, the use of knives remained relatively constant throughout the three periods.

**9-1. Freq by DISTRICT :split by pandemic phrases(Avg.Robbery(per month)**

  + The section presents the frequency of robbery incidents by police district, the root category of the PSA (Police Service Area).
  + The data reveals that **during lockdown, robbery incidents significantly decreased in DISTRICT2 and 3 compared to pre-pandemic and post-pandemic times. However, robbery incidents increased in DISTRICT5-7 during the same period.**
  + Furthermore, the portion of robbery incidents in DISTRICT5 and DISTRICT6 increased consistently across all three periods, on the other hand, the portion of robbery incidents in DISTRICT7 increased during lockdown but decreased in the post-pandemic period.


```{r}

temp <- count(Robbery,DISTRICT, sort=FALSE)

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 48) #1
temp[2,3] = as.integer(temp[2,2] / 48) #
temp[3,3] = as.integer(temp[3,2] / 48) #
temp[4,3] = as.integer(temp[4,2] / 48) #
temp[5,3] = as.integer(temp[5,2] / 48) #
temp[6,3] = as.integer(temp[6,2] / 48) #
temp[7,3] = as.integer(temp[7,2] / 48) #7
#temp[7,3] = as.integer(temp[7,2] / 48) #NA

x <-  c("1","2","3","4","5","6","7")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3],temp[5,3],temp[6,3],temp[7,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="DISTRICT", y="Avg.Robbery") +
  labs(title="H1.Robbery BY DISTRICT./M") + scale_x_discrete(limits=c("1","2","3","4","5","6","7")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Pre
temp <- count(Robbery_pre,DISTRICT, sort=FALSE) 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 14) #SUN
temp[2,3] = as.integer(temp[2,2] / 14) #
temp[3,3] = as.integer(temp[3,2] / 14) #
temp[4,3] = as.integer(temp[4,2] / 14) #
temp[5,3] = as.integer(temp[5,2] / 14) #
temp[6,3] = as.integer(temp[6,2] / 14) #
temp[7,3] = as.integer(temp[7,2] / 14) #SAT

x <-  c("1","2","3","4","5","6","7")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3],temp[5,3],temp[6,3],temp[7,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_pre <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="DISTRICT", y="Avg.Robbery") +
  labs(title="H1_1.Robbery BY DISTRICT(Pre)") + scale_x_discrete(limits=c("1","2","3","4","5","6","7")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Lock
temp <- count(Robbery_lock,DISTRICT, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) #SUN
temp[2,3] = as.integer(temp[2,2] / 17) #
temp[3,3] = as.integer(temp[3,2] / 17) #
temp[4,3] = as.integer(temp[4,2] / 17) #
temp[5,3] = as.integer(temp[5,2] / 17) #
temp[6,3] = as.integer(temp[6,2] / 17) #
temp[7,3] = as.integer(temp[7,2] / 17) #SAT

x <-  c("1","2","3","4","5","6","7")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3],temp[5,3],temp[6,3],temp[7,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_lock <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="DISTRICT", y="Avg.Robbery") +
  labs(title="H1_2.Robbery BY DISTRICT(Lock)") + scale_x_discrete(limits=c("1","2","3","4","5","6","7")) + geom_text(aes(label=signif(y)),vjust = 1.5)

#Post
temp <- count(Robbery_post,DISTRICT, sort=FALSE)  

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 17) #SUN
temp[2,3] = as.integer(temp[2,2] / 17) #
temp[3,3] = as.integer(temp[3,2] / 17) #
temp[4,3] = as.integer(temp[4,2] / 17) #
temp[5,3] = as.integer(temp[5,2] / 17) #
temp[6,3] = as.integer(temp[6,2] / 17) #
temp[7,3] = as.integer(temp[7,2] / 17) #SAT

x <-  c("1","2","3","4","5","6","7")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3],temp[5,3],temp[6,3],temp[7,3])

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_shift_post <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="DISTRICT", y="Avg.Robbery") +
  labs(title="H1_3.Robbery BY DISTRICT(Post)") + scale_x_discrete(limits=c("1","2","3","4","5","6","7")) + geom_text(aes(label=signif(y)),vjust = 1.5)


grid.arrange(plot_shift, plot_shift_pre, plot_shift_lock, plot_shift_post,
             ncol=2, nrow=2)

```


We can see that District 6 had the highest number of robbery incidents overall, followed by District 3, while District 2 had the lowest number of incidents.

During the lockdown period, there was a decrease in robbery incidents across most districts, except for Districts 5-7, where incidents actually increased.

Looking at the changes in the number of incidents for each district, we can see that District 1 had the biggest increase in incidents between the pre-lockdown and post-lockdown periods, while District 3 had the smallest increase. Districts 6 had the biggest increase in incidents during the lockdown period.

Overall, the histograms suggest that there were some changes in the patterns of robbery incidents across different districts over time, with some districts experiencing more dramatic changes than others.

**10-1. Boxplot distribution of PSA :split by pandemic phrases**

The plot suggests that during the pandemic, the median PSA values remained relatively stable, with only a slight decrease in the post-lock phase. However, the plot also shows a significant increase in outliers during the lockdown and post-lock phases, indicating a higher variability in the data. In particular, the plot highlights a steep increase in the PSA values for districts 5-7 during the pandemic.

```{r}
boxplot_PSA <- ggplot(Robbery, aes(y=PSA, x=Period_cat, fill=Period_cat)) + 
  geom_boxplot() + 
  geom_boxplot( colour=c("#ff0000","#11cc11","#0000ff"), outlier.shape=8,
                outlier.colour="lightblue", outlier.size=4) +  labs(title="I_1. Box Plot of Robbery by Location(PSA)", x="Period", y = "Location (PSA) of Robbery")

boxplot_PSA
```

**10-2. Boxplot distribution of Clearance rate :split by pandemic phrases**

Overall, high clearance rates, which indicate that it took more time to complete the robbery event, were observed across all pandemic periods. The plot also shows that **during the lock-down period, the number of outliers (i.e., data points that are significantly different from the rest of the data) increased, indicating a higher variance in clearance rates. This may imply that the robbery events during these periods were more severe or challenging, or that there were inefficiencies in police administration.**

```{r}
boxplot_Clearance <- ggplot(Robbery, aes(y=Clearance_rate, x=Period_cat, fill=Period_cat)) + 
  geom_boxplot() + 
  geom_boxplot( colour=c("#ff0000","#11cc11","#0000ff"), outlier.shape=8,
                outlier.colour="lightblue", outlier.size=4) +  labs(title="I_2. Box Plot of Robbery Clearance rate", x="Period", y = "Clearance_rate(Minute)")

boxplot_Clearance
```


### 3. Unusual Observations: Data Quality


**Data Quality**

We performed test for continuous variables, `OBJECTID``Clearance_rate` and `PSA`  

 + OBJECTID is just the identifying number that police defined, however, included to see somethig interesting pattern in the numbber  

**1. OBJECTID**

`OBJECTID` has no outlier. 

```{r}
Robbery_clean = outlierKD2(Robbery, OBJECTID, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
 
```

**2. PSA**

`PSA` also has no outlier.

```{r}

Robbery_clean = outlierKD2(Robbery, PSA, rm = TRUE, boxplt = TRUE, qqplt = TRUE)

```   

**3. Clearance_rate**

**The distribution of `Clearance_rate` is highly spread-wide, suggesting the presence of outliers.** To address this, **we have converted outliers with extremely high Clearance_rate to NA, which accounts for 4.8% of the data.** After cleansing outliers having the average clear time was 3656 minutes(2.5 days), the mean clearance rate for robbery incidents decreased from 215 to 50 minutes, which indicates that it took about 1 hours to clear the incidents. 
We will use the outlier-excluded data to ensure a comprehensive analysis.

We identified outliers and replaced with NAs. This approach allows us to retain the maximum amount of data while still removing any data points that may negatively impact our analysis.

```{r}
Robbery_clean = outlierKD2(Robbery, Clearance_rate, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
#str(Robbery_clean)
```

```{r, results='hide'}
#make a summary table
Robbery_avg_clr <-  Robbery_clean %>% group_by(Period_cat) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_avg_clr, Period_cat) 

Robbery_avg_clr <- data.frame(Robbery_avg_clr)
```

```{r}
xkabledply(Robbery_avg_clr, title = "Avg.Robbery clearance by phase")
```

**The mean clearance rate for robbery incidents split by pandemic phrases implies violent crime increased during the lockdown period.**


### 3. Additional Exploratory plots of robbery incidents (DISTRICT, METHOD, SHIFT)


**1. DISTRICT**    

  + As we mentioned in the previous analysis, **the Robbery number of Districts 5-7 only increased during lockdown. Furthermore, even the difficulty of robbery also increased.**
  + While Districts 2-3 shows the exactly opposite pattern, significantly decreased both the amount and the difficulty of the robbery incidents for the same period.

These results could help law enforcement agencies to allocate their resources more effectively by focusing more on the high-risk areas (districts 5-7), especially during the pandemic times. It could also suggest that **there may be underlying socio-economic factors contributing to the increase in robbery incidents in these districts during the lockdown**. Overall, the data reveals some interesting patterns that could inform policymakers and law enforcement agencies to make data-driven decisions in preventing and addressing robbery incidents in different districts of the city.

**A. Robbery amount ** 

```{r}
prop.1 <- with(Robbery_clean, table(Period_cat, DISTRICT)) %>% 
          prop.table(margin = 1)

xkabledply(prop.1*100, title = "Robbery propotion by District(%)")

#contable = table(Robbery_clean$Period_cat, Robbery_clean$DISTRICT)
```

**B. Robbery quality ** 

```{r, results='hide'}
#make a summary table
Robbery_avg_clr <-  Robbery_clean %>% group_by(Period_cat,DISTRICT) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_avg_clr, Period_cat,DISTRICT) 

Robbery_avg_clr <- data.frame(Robbery_avg_clr)
```
```{r}
plot_DISTRICT_add <- ggplot(Robbery_avg_clr, aes(DISTRICT, avg_Clearance_rate, colour = Period_cat)) + geom_line() + labs(x="district", y="Avg.clearance(minute)") +
  labs(title="Avg.clearance by district") + scale_x_discrete(limits=c("1","2","3","4","5","6","7")) + geom_point()

plot_DISTRICT_add

#ggplot(data=Robbery_clean)+
#  geom_point(mapping = aes(x=DISTRICT, y=METHOD, color=Period_cat))+
#  ggtitle("Scatterplot of DISTRICT vs Clearance_rate for pendamic phrases")+
#  labs(x="DISTRICT", y = "Clearance_rate(minute)")

```

**2. METHOD** 

  + The consistent increase in the portion of gun robberies indicates the growing trend of gun use in robbery incidents.
  + Interestingly, the difficulty of gun robbery also increased with increasing of the number during lockdown, however, decreased in post-pandemic.
  + The difficulty of knife robbery shows high fluctuation despite the amount of robbery has been decreasing.  

This indicates that police should focus more on the high-risk incidents.


**A. Robbery amount ** 

```{r}
prop.1 <- with(Robbery_clean, table(Period_cat, METHOD)) %>% 
          prop.table(margin = 1)

xkabledply(prop.1*100, title = "Robbery propotion by METHOD(%)")

```

**B. Robbery quality ** 

```{r, results='hide'}
#make a summary table
Robbery_avg_clr <-  Robbery_clean %>% group_by(METHOD,Period_cat) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_avg_clr, METHOD, Period_cat) 

Robbery_avg_clr <- data.frame(Robbery_avg_clr)
```

```{r}
plot_METHOD_add <- ggplot(Robbery_avg_clr, aes(Period_cat, avg_Clearance_rate, group = METHOD, ,colour = METHOD)) + geom_line() + labs(x="Phase", y="Avg.clearance(minute)") + geom_point() + labs(title="Avg.clearance by METHOD")

plot_METHOD_add
```

**3. SHIFT** 

  + The difficulty of robberies occured in evening and midnight shows growing trend though the proprtion of robbery by Shift relatively stable during lockdown. 
  + On the other hand, the difficulty robbery occured in daytime decreased, however, the number of robbery slightly increased in post-pandemic.

This indicates the risk of incidents by timezone also vaires especially during lockdown.

**A. Robbery amount ** 

```{r}
prop.1 <- with(Robbery_clean, table(Period_cat, SHIFT)) %>% 
          prop.table(margin = 1)

xkabledply(prop.1*100, title = "Robbery propotion by SHIFT(%)")

```

**C. Robbery quality ** 

```{r, results='hide'}
#make a summary table
Robbery_avg_clr <-  Robbery_clean %>% group_by(SHIFT,Period_cat) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_avg_clr, SHIFT, Period_cat) 

Robbery_avg_clr <- data.frame(Robbery_avg_clr)
```

```{r}

plot_SHIFT_add <- ggplot(Robbery_avg_clr, aes(Period_cat, avg_Clearance_rate, group = SHIFT, ,colour = SHIFT)) + geom_line() + labs(x="Phase", y="Avg.clearance(minute)") + geom_point() + labs(title="Avg.clearance by SHIFT")

plot_SHIFT_add
```


```{r, results='hide'}
## (Temporary) Organize Datasets before moving on to the Hypothesis test
 
### Wrap-up final datasets Save (Begin next step by loading these data)

# 1. Main datasets: 5 (2 total, 3 subsets)

#  + original: Robbery, pre, lock, post
#  + outlier excluded data: Robbery_clean

# 2. Summary datasets: 5 
 
#  + (Sum of frequency, origin from Robbery_clean) 
#    Robbery_date_sum, Robbery_month_sum, Robbery_Date_cat_sum
    
#  + (Average of clearance_rate) 
#    Robbery_district_avg_clr (origin from both Robbery),
#   Robbery_clean_district_avg_clr (origin from Robbery_clean)

### (Mar 4) Creating variable for hypothesis test (ANd save again)

#  + Period_cat(pre,lock,post) > Period_cat_num(1,2,3)

attach(Robbery)
Robbery$Period_cat_num[Period_cat == 'Pre'] <- 1
Robbery$Period_cat_num[Period_cat == 'Lock'] <- 2
Robbery$Period_cat_num[Period_cat  == 'Post'] <- 3
detach(Robbery)

temp <- select(Robbery_clean,REPORT_DAT_2,Period_cat)
  
Robbery_date_sum <- count(temp,REPORT_DAT_2,Period_cat, sort=FALSE)
#str(Robbery_date_sum)
arrange(Robbery_date_sum, REPORT_DAT_2)  #Ascending
#head(Robbery_date_sum,5)  

#*The first 4 rows of the first summary dataset (Robbery_date_sum) are:*
xkabledply(Robbery_date_sum[1:4,], title = "First Four Rows of Dataframe: `Robbery_date_sum`")

##########

temp <- select(Robbery_clean,Month_3,Period_cat)
  
Robbery_month_sum <- count(temp,Month_3,Period_cat, sort=FALSE)
#str(Robbery_date_sum)
arrange(Robbery_month_sum, Month_3)  #Ascending
#head(Robbery_date_sum,10)  

#*The first 4 rows of the second summary dataset (Robbery_month_sum) are:*
xkabledply(Robbery_month_sum[1:4,], title = "First Four Rows of Dataframe: `Robbery_month_sum`")

##########

temp <- select(Robbery_clean,Date_cat,Period_cat)
  
Robbery_Date_cat_sum <- count(temp,Date_cat,Period_cat, sort=FALSE)
#str(Robbery_date_sum)
arrange(Robbery_Date_cat_sum, Date_cat,Period_cat)  #Ascending
#head(Robbery_date_sum,10)  

#*The third summary dataset (Robbery_Date_cat_sum) are:*
xkabledply(Robbery_Date_cat_sum, title = "Dataframe: `Robbery_Date_cat_sum`")

Robbery_district_avg_clr <-  Robbery %>% group_by(Period_cat, DISTRICT) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_district_avg_clr, Period_cat,DISTRICT) 

Robbery_district_avg_clr <- data.frame(Robbery_district_avg_clr)

#*The first 4 rows of the fourth summary dataset (Robbery_district_avg_clr) are:*
#  + Robbery_district_avg_clr: origin for **Robbery**

xkabledply(Robbery_district_avg_clr[1:4,], title = "Dataframe: `Robbery_district_avg_clr`")

####################
Robbery_clean_district_avg_clr <-  Robbery_clean %>% group_by(Period_cat, DISTRICT) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_clean_district_avg_clr, Period_cat,DISTRICT) 

Robbery_clean_district_avg_clr <- data.frame(Robbery_clean_district_avg_clr)


#*The first 4 rows of the fifth summary dataset (Robbery_clean_district_avg_clr) are:*
#  + Robbery_clean_district_avg_clr: origin for **Robbery_clean (outlier excluded)**
  
xkabledply(Robbery_clean_district_avg_clr[1:4,], title = "Dataframe: `Robbery_district_avg_clr`")

#Save current data
#readr::write_rds(Robbery, "Robbery_230303.Rds")
#readr::write_rds(Robbery_pre, "Robbery_pre_230303.Rds")
#readr::write_rds(Robbery_lock, "Robbery_lock_230303.Rds")
#readr::write_rds(Robbery_post, "Robbery_post_230303.Rds")
#readr::write_rds(Robbery_clean, "Robbery_clean_230303.Rds")

#readr::write_rds(Robbery_date_sum, "Robbery_date_sum_230303.Rds")
#readr::write_rds(Robbery_month_sum, "Robbery_month_sum_230303.Rds")
#readr::write_rds(Robbery_Date_cat_sum, "Robbery_Date_cat_sum_230303.Rds")
#readr::write_rds(Robbery_district_avg_clr, "Robbery_district_avg_clr_230303.Rds")
#readr::write_rds(Robbery_clean_district_avg_clr, "Robbery_clean_district_avg_clr_230303.Rds")


#Use this code to load
#Robbery <- 
#  readr::read_rds("Robbery_230303.Rds")

#Robbery_clean <- 
#  readr::read_rds("Robbery_clean_230303.Rds")

#Load subset
#Robbery_pre <- 
#  readr::read_rds("Robbery_pre_230303.Rds")

#Robbery_lock <- 
#  readr::read_rds("Robbery_lock_230303.Rds")

#Robbery_post <- 
#  readr::read_rds("Robbery_post_230303.Rds")

#Robbery_date_sum <- 
#  readr::read_rds("Robbery_date_sum_230303.Rds")

#Robbery_month_sum <- 
#  readr::read_rds("Robbery_month_sum_230303.Rds")

#Robbery_Date_cat_sum <- 
#  readr::read_rds("Robbery_Date_cat_sum_230303.Rds")

#Robbery_district_avg_clr <- 
#  readr::read_rds("Robbery_district_avg_clr_230303.Rds")

#Robbery_clean_district_avg_clr <- 
#  readr::read_rds("Robbery_clean_district_avg_clr_230303.Rds")

```
## Hypothesis test 1- Anova test

Hypothesis test aims to Find a statistical evidence if there is significant difference between three phases, in terms of **<u> robbery pattern of pre-pandemic, lock-down, and post-pandemic.</u> **) 

 + ANOVA: compare means among different groups 
 + Chi square: test the independence of two variables  

By specifying robbery pattern, We set up 3 Anova tests and 5 Chi square tests as belows.
level of significance standard $\alpha$ = 0.05 (The 95% confidence level.

### 1. Daily robbery frequency 


  +  Null hypothesis: $H_0:$ The Washington DC has same means of daily robbery frequency in `pre-pandemic`,`lock-down`, and `post-pandemic` phases.

  +  Alternative hypothesis: $H_1:$ The means of daily robbery frequency of three phases are NOT all the same.

  + The p-value is **0.0008**, which is < $\alpha$ (0.05).
  + **So we can reject $H_0$ at the 95% significance level and support the alternative hypothesis. **

```{r}
Robbery_date_sum_exc = outlierKD2(Robbery_date_sum, n, rm = TRUE)
anova_dayily_rob_exc = aov(n~Period_cat, data = Robbery_date_sum_exc)

anova_summary_exc = summary(anova_dayily_rob_exc)
xkabledply(anova_summary_exc)
```

### 2. Monthly robbery frequency 


  +  Null hypothesis: $H_0:$ The Washington DC has same means of monthly robbery frequency in `pre-pandemic`,`lock-down`, and `post-pandemic` phases.

  +  Alternative hypothesis: $H_1:$ The means monthly robbery frequency of three phases are NOT all the same.
  
  + The p-value is **0.235**, which is > $\alpha$ (0.05).
  + **So we fail to reject the null hypothesis $H_0$ at the 95% significance level. **
  
```{r}
Robbery_month_sum_exl = outlierKD2(Robbery_month_sum, n, rm = TRUE)
anova_monthly_rob = aov(n~Period_cat, data = Robbery_month_sum_exl)
anova_summary = summary(anova_monthly_rob)
xkabledply(anova_monthly_rob)
```


### 3. Daily robbery clearance rate

**(A) Anova test**

  +  Null hypothesis: $H_0:$ The Washington DC has same means of daily robbery clearance rate in `pre-pandemic`,`lock-down`, and `post-pandemic` phases.

  +  Alternative hypothesis: $H_1:$ The means daily robbery clearance rate of three phases are NOT all the same.
  
  + The p-value is **0.00067**, which is < $\alpha$ (0.05).
  + **So, we can reject $H_0$ at the 95% significance level and support the alternative hypothesis. **

```{r, results='hide'}

Robbery_avg_clr <-  Robbery_clean %>% group_by(Period_cat, REPORT_DAT_2) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_avg_clr, Period_cat,REPORT_DAT_2) 

Robbery_avg_clr <- data.frame(Robbery_avg_clr)
```

```{r}
anova_daily_rob = aov(avg_Clearance_rate~Period_cat, data = Robbery_avg_clr)

anova_summary = summary(anova_daily_rob)
xkabledply(anova_daily_rob)
```

## Hypothesis test 2- Chi square test

  + We used Chi square tests to test the independence of two variables we chose. 
  
### 1.Period_cat ~ Season

  +  Null hypothesis: $H_0:$ Period_cat (pre, lock, post) and season are independent

  +  Alternative hypothesis: $H_1:$ They are not independent. 


```{r}
table1 = table(Robbery$Period_cat, Robbery$Season)
xkabledply(table1, title="Contingency table 1")
chitest1 = chisq.test(table1)
chitest1
```

  + The p-value is significantly less than 0.05.
  
  + **So, we can reject $H_0$ at the 95% significance level and support the alternative hypothesis. **
 
### 2.Period_cat ~ Day_cat_2

  +  Null hypothesis: $H_0:$ Period_cat (pre, lock, post) and Day_cat_2(weekday, weekend) are independent

  +  Alternative hypothesis: $H_1:$ They are not independent. 
```{r}
table2 = table(Robbery$Period_cat, Robbery$Day_cat_2)
xkabledply(table2, title="Contingency table 2")
chitest2 = chisq.test(table2)
chitest2
```
  + The p-value is **0.6**, so we fail to reject the null hypothesis. 


### 3.Period_cat ~ Method

  +  Null hypothesis: $H_0:$ Period_cat (pre, lock, post) and method (gun, knife, others) are independent

  +  Alternative hypothesis: $H_1:$ They are not independent. 
```{r}
table3 = table(Robbery$Period_cat, Robbery$METHOD)
xkabledply(table3, title="Contingency table3")
chitest3 = chisq.test(table3)
chitest3
```
  + The p-value is significantly less than 0.05.
  
  + **So, we can reject $H_0$ at the 95% significance level and support the alternative hypothesis. **


### 4.Period_cat ~ Month

  +  Null hypothesis: $H_0:$ Period_cat (pre, lock, post) and month are independent

  +  Alternative hypothesis: $H_1:$ They are not independent. 
```{r}
table4 = table(Robbery$Period_cat, Robbery$Month)
xkabledply(table4, title="Contingency table 4")
chitest4 = chisq.test(table4)
chitest4
```
  + The p-value is significantly less than 0.05.
  
  + **So, we can reject $H_0$ at the 95% significance level and support the alternative hypothesis. **

### 5.Period_cat ~ DISTRICT 

  +  Null hypothesis: $H_0:$ Period_cat (pre, lock, post) and DISTRICT  are independent

  +  Alternative hypothesis: $H_1:$ They are not independent. 
```{r}
table5 = table(Robbery$Period_cat, Robbery$DISTRICT)
xkabledply(table5, title="Contingency table 5")
chitest5 = chisq.test(table5)
chitest5
```
  + The p-value is significantly less than 0.05.
  
  + **So, we can reject $H_0$ at the 95% significance level and support the alternative hypothesis. **


## Conclusion

 + Our analysis supports the findings of the Boman and Gallupe (2020) study that violent crime increased during the lockdown period though average frequency of Robbery per month decreased. 

 + In addition, we found that robbery frequency changed throughout the pandemic, which relates to our ANOVA test of Daily Robbery Frequency ~ Period_cat (pre, lockdown, post) with a p-value of 0.0008.
 
 + By EDA, we found there may be underlying socio-economic factors contributing to change in robbery patterns.

 + Our EDA showed that the number of robberies in Autumn dramatically increased in the lockdown period.
 
 + It showed that significant changes in the relationship between districts and the frequency and difficulty of robberies before and after the pandemic period. For instance, the robbery incidents in districts 5-7 showed a dramatic increase during lockdown not only in the number but also in the difficulty.

 + It also showed that guns were increasingly used as a method of robbery, which also relates to our Chi-square test (Period_cat ~ Method).

 + Our tests showed that there is no change in robbery patterns (beginning, middle, and end of the month), however, there is a change in robbery patterns during different times of the day (daytime, evening, and midnight).


## References 


 + Boman, J. H., Gallupe, O. (2020). Has COVID-19 Changed Crime? Crime Rates in the United States during the Pandemic. American Journal of Criminal Justice, 45(4), 525–547. https://doi.org/10.1007/s12103-020-09551-3


 +  Council of the District of Columbia (NA).. Retrieved from https://code.dccouncil.gov/us/dc/council/code/sections/22-2801


 +  Metropolitan Police Department. (2022). Crime statistics. Retrieved from https://mpdc.dc.gov/page/crime-statistics§ 22–2801. Robbery. 



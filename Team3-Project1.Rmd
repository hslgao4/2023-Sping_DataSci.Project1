---
title: "The Impact of COVID-19 Lockdown on Robbery Rates: An Exploratory Data Analysis (EDA) of Criminal Activity in Washington D.C."
author: "Muhannad Alwhebie, Liang Gao, Nammin Woo"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=F}
#nammin revise: add library options
library(ezids)
library(readr) #install & load 
library(ggplot2)
library(DBI) #SQL
library(magrittr)
library(dplyr)  #for data manipulation.
library(tidyr) #for data tidying.
library(tidyverse)
library(graphics) 
library(gridExtra) #graph arrange(positioning)
```

# The Effect of COVID-19 Lockdown on Robbery Incidents in Washington D.C.

## Abstract
A. Briefly introduce the topic and purpose of the study
B. Summarize the key findings and conclusions of the study
 


## Introduction

The COVID-19 pandemic has impacted various aspects of daily life, including crime rates. This EDA project examines the impact of the COVID-19 lockdown on robbery rates in Washington D.C using a dataset of roughly 8000 observations. The study analyzes the pre-pandemic, lockdown, and post-pandemic periods (2019-2022) to determine significant changes in robbery frequency. Robbery is defined by the Code of the District of Columbia as taking anything of value from the person or immediate actual possession of another by force or violence, putting in fear, or by sudden or stealthy seizure or snatching. The project explores differences in robbery patterns during the pandemic compared to pre/post-pandemic times. It also investigates changes in the relationship between the day of the week and the frequency of robberies before and after the pandemic period. Additionally, the project examines changes in the relationship between the day of the month and the frequency of robberies before and after the pandemic period. Finally, the study identifies significant changes in the frequency of robberies among districts before and after the pandemic.


The study by Boman and Gallupe (2020), suggests that the COVID-19 pandemic and the associated mandatory stay-at-home orders have had a differential impact on crime rates in the US. While overall crime rates, as measured by calls for service to law enforcement, have decreased compared to the pre-pandemic year of 2019, this drop appears to be driven by decreases in minor offenses that are typically committed in peer groups. In contrast, serious crimes that are generally not committed with co-offenders, such as homicide and intimate partner violence, have either remained constant or increased. The study raises the possibility that mandatory lockdown orders may have displaced minor offenders into situations where there is a greater opportunity for serious crimes, particularly intimate partner violence and homicide.


In order to understand the impact of COVID-19 lockdown on robbery rates in Washington D.C, it is important to first examine the overall crime rates in the area prior to the pandemic. According to the Metropolitan Police Department's crime statistics, the overall crime rate in Washington D.C. has been decreasing in recent years. In 2019, there were 31,700 reported incidents of crime, a decrease from 37,265 in 2016. However, within this overall trend, there have been fluctuations in specific types of crimes, including robbery. Moreover, Robbery has been a persistent problem in Washington D.C., particularly in certain areas of the city. In 2019, there were 2,700 reported incidents of robbery, down from 2,977 in 2015. As such, it is important to examine how the COVID-19 pandemic and associated lockdown measures have impacted robbery rates in the city. This analysis will provide insight into how the pandemic has affected crime patterns in a major urban area and may inform future policy decisions related to crime prevention and public safety.





```{r setup, include=FALSE}
#nammin revise: knitr::opts_chunk$set(echo = TRUE) > combined as following
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
options(scipen=9999, digits = 3) 
#options(scientific=T, digits = 3) 
#options(scipen = 9999) # suppress scientific notation
```

## Methodology

### 1. Data  
In the opening section of this report, we provide a comprehensive overview of the data used in our analysis. <<<We obtained our data from the Metropolitan Police Department in Washington D.C., and specifically focused on the Crime Incidents dataset.

The dataset contains detailed information on robbery incidents that occurred between 2019 and 2022, and we extracted this information into our dataset titled "Robbery_DC_clean.csv".>>>

In this section, we will provide a commentary on the data, highlighting its strengths and limitations. This information is critical in providing context for the analysis and understanding the potential impact of any data-related issues on the conclusions drawn from our analysis.

Furthermore, we will discuss the data cleaning and preprocessing steps taken to ensure that the data is suitable for analysis. These steps include removing duplicate records, addressing missing values, and identifying and handling outliers.

We will also provide an overview of the variables included in the dataset, such as the date and time of the robbery incident, the location of the incident, the method used, and other relevant details. This information is essential in developing a comprehensive understanding of the robbery incidents and their potential relationship to the COVID-19 lockdown.

Overall, this section provides a solid foundation for the analysis that follows, and we have taken great care to ensure that the data is reliable, relevant, and suitable for our analysis.


### 2. Data Wrangling and Preprocessing

```{r}
#Import
Robbery = data.frame(read.csv("Robbery_DC_clean.csv"))

#Import
#str(Robbery)  
```



This section typically involves importing, cleaning, and pre-processing raw data to prepare it for analysis. The data cleaning process include removing duplicate records, addressing missing values, identifying and handling outliers, and transforming variables as needed. By performing these steps, we can ensure that the data is suitable for analysis and that our conclusions are based on accurate and reliable information. In this section, we will provide an overview of the data wrangling and pre-processing steps taken for the "Robbery_DC_clean.csv" dataset used in our analysis. 


```{r}
#create Clearance_rate(Unit: Minute)= END_DATE - START_DATE 

#1. 'Date' format 

Robbery$START_DATE_2 <- as.POSIXct(Robbery$START_DATE,format = "%Y/%m/%d %H:%M:%S")
Robbery$END_DATE_2 <- as.POSIXct(Robbery$END_DATE,format = "%Y/%m/%d %H:%M:%S")

```

```{r}
Robbery$Clearance_rate <- as.numeric(difftime(strptime(Robbery$END_DATE_2,"%Y-%m-%d%H:%M:%S"),strptime(Robbery$START_DATE_2,"%Y-%m-%d %H:%M:%S")))/60 

Robbery$Clearance_rate <- format(round(Robbery$Clearance_rate, 0), nsmall = 0)
Robbery$Clearance_rate<- as.integer(Robbery$Clearance_rate)
```

```{r}
#head(select(Robbery,START_DATE, START_DATE_2, END_DATE_2,Clearance_rate),5)
#strptime(paste(Robbery$START_DATE, Robbery$END_DATE), "%Y-%m-%d")  #%H:%M

#column remove
Robbery <- select(Robbery,-Robbery_Time, -START_DATE, -END_DATE)
#as.numeric(difftime(strptime(END_DATE_2,"%Y-%m-%d%H:%M:%S"),strptime(START_DATE_2,"%Y-%m-%d %H:%M:%S"))) 

#rename
Robbery <-rename(Robbery, START_DATE = START_DATE_2)
Robbery <-rename(Robbery, END_DATE = END_DATE_2)  

```

```{r}
# change datatypes of Char.var for EDA (as Factor)
cols <- c('Period_cat','Period_cat_2','Month_2','Month_3','Season','Date_cat','Day_cat_2','SHIFT','METHOD')


Robbery %<>%
       mutate_each_(funs(factor(.)),cols)

#Category var. label order fix
Robbery$Period_cat <- factor(Robbery$Period_cat, levels=c("Pre", "Lock", "Post"))

Robbery$Season <- factor(Robbery$Season, levels=c("SPRING", "SUMMER", "AUTUMN", "WINTER"))
   
#Robbery$SHIFT<- as.factor(Robbery$SHIFT) 
```


*The variables in the dataset are:*

```{r}
str(Robbery)

#colnames(Robbery)
#ncol(Robbery)
#nrow(Robbery)
```

*The first 4 rows of the dataframe are:*

```{r}

xkabledply(Robbery[1:4,], title = "First Four Rows of Dataframe: `Robbery`")

```


*The last 4 rows of the dataframe are*
```{r}
xkabledply(Robbery[(nrow(Robbery)-3):nrow(Robbery),], title = "Last Four Rows of Dataframe: `Robbery`")
```


The dataset consists of *8343* observations and *22* variables, including:

* `OBJECTID`: a unique identifier for each robbery incident
* `Seq`: a sequential number for each robbery incident
* `OFFENSE`: the type of offense, which is always "ROBBERY" in this dataset
* `REPORT_DAT`: the date and time the robbery incident was reported
* `REPORT_DAT_2`: the date the robbery incident was reported
* `Period_cat`: a categorical variable indicating whether the robbery occurred before, during, or after the COVID-19 lockdown period
* `Period_cat_2`: a categorical variable indicating the period of the robbery incident, which can be "Lockdown," "Post-Lockdown," "Pre-Lockdown," or "During-Lockdown"
* `Year`: the year the robbery incident occurred
* `Month`: the month the robbery incident occurred (Transformed: Month_2, Month_3)
* `Season`: the season in which the robbery incident occurred
* `Date`: the day of the month the robbery incident occurred
* `Date_cat`: a categorical variable indicating whether the robbery incident occurred at the beginning, middle, or end of the month
* `Time_hour`: the hour of the day the robbery incident occurred
* `SHIFT`: a categorical variable indicating the shift during which the robbery incident occurred, which can be "DAY," "EVENING," or "NIGHT"
* `Day_cat`: the day of the week the robbery incident occurred, represented as an integer
* `Day_cat_2`: a categorical variable indicating whether the robbery incident occurred on a weekday or weekend
* `METHOD`: a categorical variable indicating the method used in the robbery, which can be "GUN," "KNIFE," or "OTHER"
* `DISTRICT`: the police district where the robbery incident occurred, represented as an integer
* `PSA`: the police service area where the robbery incident occurred, represented as an integer
* `START_DATE`: the date and time the robbery incident started
* `END_DATE`: the date and time the robbery incident ended
* `Clearance_rate`: the percentage of robbery incidents that were cleared by the police




## Analysis 


### 2. Summary statistics

In this section, we provide a detailed overview of the summary statistics of some quantitative datas in our data set. This information includes measures such as the mean, median, standard deviation, minimum, and maximum values.

We will also examine other measures, such as the interquartile range (IQR) and coefficient of variation, to provide a more comprehensive understanding of the data's variability and dispersion.

By analyzing the summary statistics, we can identify any significant trends or patterns in the data, such as the overall frequency of robbery incidents, the distribution of robbery incidents across different days of the week or months, and the most common methods used in robbery incidents.

We will also provide a commentary on the summary statistics, highlighting any notable findings or trends that may impact the analysis of the data. This analysis will help to identify potential issues or areas of interest that require further investigation in subsequent sections of the report.

Overall, the summary statistics provide a critical foundation for the analysis of the robbery data, enabling us to develop a more accurate and detailed understanding of the impact of the COVID-19 lockdown on robbery rates in Washington D.C.

```{r}
#Summary
#columns to analyse 
cols <- c('Period_cat','Period_cat_2','Year', 'Month',
          'Season','Date_cat','Date',
          'SHIFT','Time_hour','Clearance_rate','Day_cat','Day_cat_2',
          'METHOD','DISTRICT','PSA')

knitr::kable(summary(select(Robbery,cols)), format = "markdown", caption="Overall summary statistics of Robbery between 2019 to 2022 in D.C")

#Freq
#Robbery %>%  
#  count(Clearance_rate)

#Where
#Robbery |>   
#  filter(Clearance_rate > 1440)  # more that one-day

```

Key statistics of individual Quantitative variable are:

   + `Month`: Mean(`r mean(Robbery$Month,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Month, na.rm = TRUE)`), Variance(`r var(Robbery$Month, na.rm = TRUE)`)
   
```{r}
mean(Robbery$Month,na.rm = TRUE)
sd(Robbery$Month, na.rm = TRUE)
var(Robbery$Month, na.rm = TRUE)
```

   + `Date`: Mean(`r mean(Robbery$Date,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Date, na.rm = TRUE)`), Variance(`r var(Robbery$Date, na.rm = TRUE)`)
   
```{r}
mean(Robbery$Date,na.rm = TRUE)
sd(Robbery$Date, na.rm = TRUE)
var(Robbery$Date, na.rm = TRUE)
```

   + **`Day_cat`** (Sun= 1, Mon:2, Tue:3, Wed:4, Thr:5, Fri: 6, Sat: 7): Mean(`r mean(Robbery$Day_cat,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Day_cat, na.rm = TRUE)`), Variance(`r var(Robbery$Day_cat, na.rm = TRUE)`)
   
```{r}
mean(Robbery$Day_cat,na.rm = TRUE)
sd(Robbery$Day_cat, na.rm = TRUE)
var(Robbery$Day_cat, na.rm = TRUE)
```
   + **`Time_hour`**
   1. Mean(`r mean(Robbery$Time_hour,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Time_hour, na.rm = TRUE)`), Variance(`r var(Robbery$Time_hour, na.rm = TRUE)`)
   
   2. AM7~12: 1568, PM 12~18: 1114, 18~23:1937, **0~7: 3724**(`r round(3724/8343*100,0)`)%,

     
```{r}
mean(Robbery$Time_hour,na.rm = TRUE)
sd(Robbery$Time_hour, na.rm = TRUE)
var(Robbery$Time_hour, na.rm = TRUE)

```

```{r}
# 7~12: 1568, 12~18: 1114, 18~24:1937, 0~7: 3724,
#Robbery |>   
#  filter(Time_hour>=0,Time_hour<7)  

#Robbery |>   
# filter(Time_hour>=18,Time_hour<24)  
```


   + **`Clearance_rate`** (Minute, `END_DATE` - `START_DATE`, )
   
   1. Mean(`r mean(Robbery$Clearance_rate,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$Clearance_rate, na.rm = TRUE)`), Variance(`r var(Robbery$Clearance_rate, na.rm = TRUE)`)
   
   2. Freq: more than 1 hour is **2599**(`r round(2599/8343*100,0)`%) 
      
```{r,}
mean(Robbery$Clearance_rate,na.rm = TRUE)
sd(Robbery$Clearance_rate, na.rm = TRUE)
var(Robbery$Clearance_rate, na.rm = TRUE)

```

```{r}
# more that 1 hours: 2,599
#Robbery |>   
#  filter(Clearance_rate > 60)  
```

   + **`DISTRICT`**: Mean(`r mean(Robbery$DISTRICT,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$DISTRICT, na.rm = TRUE)`), Variance(`r var(Robbery$DISTRICT, na.rm = TRUE)`)
   
```{r}
mean(Robbery$DISTRICT,na.rm = TRUE)
sd(Robbery$DISTRICT, na.rm = TRUE)
var(Robbery$DISTRICT, na.rm = TRUE)

#Time_hour Clearance_rate PSA
```
   
   + **`PSA`**: Mean(`r mean(Robbery$PSA,na.rm = TRUE)`), Standard deviation(`r sd(Robbery$PSA, na.rm = TRUE)`), Variance(`r var(Robbery$PSA, na.rm = TRUE)`)
   
```{r}
mean(Robbery$PSA,na.rm = TRUE)
sd(Robbery$PSA, na.rm = TRUE)
var(Robbery$PSA, na.rm = TRUE)
```
  

### 3. Plots(draft)
   + comment (TBD)
   
Period_cat | Define | Description   
-----|-------|-----------  
 Pre   | Pre-pandemic (14M)   |  2019.1.1 ~2020.2.29   
Lock   | Lockdown(17M)   | 2020.3.1~ 2021. 7.31    
Post   |   Post-pandemic(17M)   | 2021.8.1~2022.12.31 


**1. Basic plots of Robbery data is below:**
   + Chart A1~A2 describe Total data (4 years,'19~'22)
   

```{r}
# Plot 1.: Freq by yeqr (x:discrete, Barchart)+Value=count(freq)

plot_year <- ggplot(data=Robbery, aes(x=Year)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + 
  labs(x="Year", y="Frequency") + labs(title="A1.Yearly Robbery Frequency")

# Plot 2.: Freq by yeqr (x:discrete, Barchart)+Value=percent of freq
plot_year_pct <- ggplot(data=Robbery, aes(x=Year, y=..count../sum(..count..)*100)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="Year", y="Percent(%)") + labs(title="A1.Yearly Robbery Frequency(%)")

# Plot 2.: Freq by Month (x:continuous, Histogram)+Value=count(freq)

plot_Month <- ggplot(data=Robbery, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2.Monthly Robbery Frequency") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

plot_Month_pct <- ggplot(Robbery, aes(x = Month)) +
  geom_histogram(aes(y = after_stat(count / sum(count))), col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) +
  stat_bin(
    binwidth = 1,geom = "text", color = "black",
    aes(y = after_stat(count / sum(count)), 
        label = scales::percent(after_stat(round(count / sum(count), 2)))),
    position = position_stack(vjust = 1.1)
  ) +
  scale_y_continuous(labels = scales::percent)+ scale_x_continuous(breaks=1:12) + 
  labs(x="Month", y="Percent(%)","A2.Monthly Robbery Frequency(%)")

  
grid.arrange(plot_year, plot_Month, plot_year_pct, plot_Month_pct, ncol=2, nrow=2)
```


**2-1.Freq by Month :split by pandemic phrases**
   + Chart A3~A4 show the Robbery frequency by pandemic phrases 
   
     (Pre: 14 Month, Lock-down: 17 Month, Post: 17 Month)

```{r}
# Plot 3.: Freq by Period phase(Pre,lockdown,post)+Value=count(freq)

plot_Period <- ggplot(data=Robbery, aes(x=Period_cat)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..), vjust = 1.5) + 
  labs(x="Phase", y="Frequency") + labs(title="A3.Robbery by Pandemic phase 
(Month: Pre=14, Lock=17, Post=17)") 


###################################
# Plot 4. average Robbery frequency per month [by Period_cat]+Value
temp <- count(Robbery,Period_cat, sort=TRUE)

#Avg
temp[1,3] = as.integer(temp[1,2] / 17 ) #post: 17M  
temp[2,3] = as.integer(temp[2,2] / 17) #lock: 17M  
temp[3,3] = as.integer(temp[3,2] / 14) #pre: 14M 

x <-  c("Pre","Lock","Post")
y  <-  c(temp[3,3],temp[2,3],temp[1,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Period_mon <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Phase", y="Avg.Robbery") +
  labs(title="A4.Avg.Robbery(per month)") + scale_x_discrete(limits=c("Pre","Lock","Post")) + geom_text(aes(label=signif(y)),vjust = 1.5)   

grid.arrange(plot_Period, plot_Period_mon, ncol=2, nrow=2)

```

```{r}
#1. by pandemic phrases
Robbery_pre <- subset(Robbery,subset = Robbery$Period_cat == 'Pre')  #2535
Robbery_lock <- subset(Robbery,subset = Robbery$Period_cat == 'Lock') #2729
Robbery_post <- subset(Robbery,subset = Robbery$Period_cat == 'Post') #3079

#2. by year
Robbery_2019 <- subset(Robbery,subset = Robbery$Year == 2019)  #2574
Robbery_2020 <- subset(Robbery,subset = Robbery$Year == 2020) #2648
Robbery_2021 <- subset(Robbery,subset = Robbery$Year == 2021)
Robbery_2022 <- subset(Robbery,subset = Robbery$Year == 2022)

```

+ Chart A2-2~A2-4 show the Monthly Robbery frequency by pandemic phrases  

  (Total: Chart A2.Monthly Robbery Frequency)

```{r}
#Same as Chart A2 (Skip)

#Sum of 4years (2019~2022)
#plot_Month <- ggplot(data=Robbery, aes(Month)) + 
#  geom_histogram(col="darkblue", 
#                 fill="lightblue", 
#                 alpha = .7) + 
#  labs(x="Month", y="Frequency") +
#  labs(title="A2-1.Monthly Robbery frequency") + scale_x_continuous(breaks=1:12) + #geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

#plot_Month
```

```{r}
# Plot.Freq by Month :split by pandemic phrase

#pre
plot_Month_pre <- ggplot(data=Robbery_pre, aes(x=Month_3)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.4) + #vjust:lable position
  labs(x="Month") + labs(title="A2-2.Monthly Robbery (Pre: 14M)")

#lock
plot_Month_lock <- ggplot(data=Robbery_lock, aes(x=Month_3)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.4) + #vjust:lable position
  labs(x="Month") + labs(title="A2-3.Monthly Robbery (Lock: 17M)") + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

#post
plot_Month_post <- ggplot(data=Robbery_post, aes(x=Month_3)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.4) + #vjust:lable position
  labs(x="Month") + labs(title="A2-4.Monthly Robbery (Post: 17M)") + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

grid.arrange(plot_Month_pre, plot_Month_lock,plot_Month_post, ncol=1, nrow=3)

```


```{r}
# Plot.Freq by Month(percent %) :split by pandemic phrase 
#> Skip(if we need, can add)

#pre
#plot_Month_pre_pct <- ggplot(data=Robbery_pre, aes(x=Month_3, y=..count../sum(..count..)*100)) + geom_bar(colour="darkblue", fill="lightblue",alpha = .7) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="Month", y="Percent(%)") + labs(title="A2-2.Monthly Robbery (Pre, %)") + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

#lock
#plot_Month_lock_pct <- ggplot(data=Robbery_lock, aes(x=Month_3, y=..count../sum(..count..)*100)) + geom_bar(colour="darkblue", fill="lightblue",alpha = .7) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="Month", y="Percent(%)") + labs(title="A2-3.Monthly Robbery (lock, %)") + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))


#plot_Month_post_pct <- ggplot(data=Robbery_post, aes(x=Month_3, y=..count../sum(..count..)*100)) + geom_bar(colour="darkblue", fill="lightblue",alpha = .7) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="Month", y="Percent(%)") + labs(title="A2-4.Monthly Robbery (post, %)") + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

#grid.arrange(plot_Month_pre_pct, plot_Month_lock_pct,plot_Month_post_pct, ncol=1, nrow=3)

```

**2-2. Freq by Month :split by Years**

```{r}
# Plot.Freq by Month :split by pandemic phrase

plot_Month_2019 <- ggplot(data=Robbery_2019, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2-5.Monthly Robbery(2019)") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 


plot_Month_2020 <- ggplot(data=Robbery_2020, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2-6.Monthly Robbery(2020)") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

plot_Month_2021 <- ggplot(data=Robbery_2021, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2-7.Monthly Robbery(2021)") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

plot_Month_2022 <- ggplot(data=Robbery_2022, aes(Month)) + 
  geom_histogram(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7) + 
  labs(x="Month", y="Frequency") +
  labs(title="A2-8.Monthly Robbery(2022)") + scale_x_continuous(breaks=1:12) + geom_text(stat='count', aes(label=..count..),vjust = 1.5) 

grid.arrange(plot_Month_2019, plot_Month_2020,plot_Month_2021, plot_Month_2022, ncol=2, nrow=2)

```

```{r}
#X-axis order check
#temp <- count(Robbery,Season, sort=FALSE) 
#temp

#temp <- count(Robbery_pre,Season, sort=FALSE) #fall, summer, winter, spring
#temp

#temp <- count(Robbery_lock,Season, sort=FALSE) #fall, summer, winter, spring
#temp

#temp <- count(Robbery_post,Season, sort=FALSE) #fall, summer, winter, spring
#temp


```



**3-1. Freq by Season :split by pandemic phrases (Avg.Robbery(per month)**
  
  + Chart B1_2 (lockdown) 
    
    At the beginning of lock-down(spring,summer) decreased
    From AUTUMN, robbery dramatically inceased again 
    continued to increase after finishing lock-down 
    Pattern of post pendamic is interesting(Summer, Winter) 

```{r}
# Number of months per each season of pandemic phrases    
#      pre	lock	post  total
#spring	3	   6	  3     12
#sum   	3	   5	  4     12
#fall 	3	   3	  6     12
#winter	5	   3	  4     12
#	     14	  17	 17     48

#Total
temp <- count(Robbery,Season, sort=FALSE) #spring, summer,AUTUMN, winter, 

#total_Avg
temp[1,3] = as.integer(temp[1,2] / 12) #spring 
temp[2,3] = as.integer(temp[2,2] / 12) #summer
temp[3,3] = as.integer(temp[3,2] / 12) #AUTUMN 
temp[4,3] = as.integer(temp[4,2] / 12) #winter 

x <-  c("SPRING","SUMMER","AUTUMN","WINTER")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Season <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="B1.Seanson_Rob_freq.(Month mean)") + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) + geom_text(aes(label=signif(y)),vjust = 1.5)   

#########Pre
temp <- count(Robbery_pre,Season, sort=FALSE) 

#pre-pen
temp[1,3] = as.integer(temp[1,2] / 3) # spring 
temp[2,3] = as.integer(temp[2,2] / 3) # summer
temp[3,3] = as.integer(temp[3,2] / 3) # AUTUMN
temp[4,3] = as.integer(temp[4,2] / 5) # winter

x <-  c("SPRING","SUMMER","AUTUMN","WINTER")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Season_pre <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="B1_1.Pre_Season_Rob./M") + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) + geom_text(aes(label=signif(y)),vjust = 1.5)   


######Lock
temp <- count(Robbery_lock,Season, sort=FALSE) 

#lock-pen
temp[1,3] = as.integer(temp[1,2] / 6) # spring 
temp[2,3] = as.integer(temp[2,2] / 5) # summer
temp[3,3] = as.integer(temp[3,2] / 3) # AUTUMN
temp[4,3] = as.integer(temp[4,2] / 3) # winter

x <-  c("SPRING","SUMMER","AUTUMN","WINTER")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Season_lock <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="B1_2.Lock_Season_Rob./M") + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) + geom_text(aes(label=signif(y)),vjust = 1.5)   

#########Post
temp <- count(Robbery_post,Season, sort=FALSE) #fall, summer, winter, spring

#post-pen
temp[1,3] = as.integer(temp[1,2] / 3) # spring 
temp[2,3] = as.integer(temp[2,2] / 4) # summer
temp[3,3] = as.integer(temp[3,2] / 6) # AUTUMN
temp[4,3] = as.integer(temp[4,2] / 4) # winter

x <-  c("SPRING","SUMMER","AUTUMN","WINTER")
y  <-  c(temp[1,3],temp[2,3],temp[3,3],temp[4,3] )

temp_2 <- data.frame(x,y)
#barplot(y, names.arg = x)

plot_Season_post <- ggplot(data=temp_2, aes(x,y)) + 
  geom_bar(col="darkblue", 
                 fill="lightblue", 
                 alpha = .7,stat='identity') + 
  labs(x="Season", y="Avg.Robbery") +
  labs(title="B1_3.Post_Season_Rob./M") + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) + geom_text(aes(label=signif(y)),vjust = 1.5) 

grid.arrange(plot_Season, plot_Season_pre, plot_Season_lock, plot_Season_post,
             ncol=2, nrow=2)

```


**3-2. Freq by Season :split by Years**

```{r}
plot_Season_2019 <- ggplot(data=Robbery_2019, aes(x=Season)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) +
  labs(x="Season") + labs(title="B1_4.Seanson_obbery (2019)")

plot_Season_2020 <- ggplot(data=Robbery_2020, aes(x=Season)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) +
  labs(x="Season") + labs(title="B1_5.Seanson_Robbery (2020)")

plot_Season_2021 <- ggplot(data=Robbery_2021, aes(x=Season)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) +
  labs(x="Season") + labs(title="B1_6.Seanson_Robbery (2021)")

plot_Season_2022 <- ggplot(data=Robbery_2022, aes(x=Season)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("SPRING","SUMMER","AUTUMN","WINTER")) +
  labs(x="Season") + labs(title="B1_7.Seanson_Robbery (2022)")


grid.arrange(plot_Season_2019, plot_Season_2020, plot_Season_2021, plot_Season_2022,
             ncol=2, nrow=2)

```

**4-1. Freq by Date_cat(Begin,Middle,End) :split by pandemic phrases**
   + 
   
   
```{r}

plot_Date_cat <- ggplot(data=Robbery, aes(x=Date_cat)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("Begin","Middle","End")) +
  labs(x="Date_cat") + labs(title="C1.Incident Date of Robbery")

plot_Date_cat_pre <- ggplot(data=Robbery_pre, aes(Date_cat)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("Begin","Middle","End")) +
  labs(x="Date_cat") + labs(title="C1_1.Incident Date (Pre)")

plot_Date_cat_lock <- ggplot(data=Robbery_lock, aes(Date_cat)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("Begin","Middle","End")) +
  labs(x="Date_cat") + labs(title="C1_2.Incident Date (Lock)")

plot_Date_cat_post <- ggplot(data=Robbery_post, aes(Date_cat)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("Begin","Middle","End")) +
  labs(x="Date_cat") + labs(title="C1_3.Incident Date (Post)")

grid.arrange(plot_Date_cat, plot_Date_cat_pre, plot_Date_cat_lock, plot_Date_cat_post,
             ncol=2, nrow=2)

```
[Percent,%] Freq by Date_cat(Begin,Middle,End) :split by pandemic phrases

```{r}

plot_Date_cat <- ggplot(data=Robbery, aes(x=Date_cat,y=..count../sum(..count..)*100)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
scale_x_discrete(limits=c("Begin","Middle","End")) +
  labs(x="Date_cat", y="Percent(%)") + labs(title="C1.Incident Date of Robbery(%)")

plot_Date_cat_pre <- ggplot(data=Robbery_pre, aes(x=Date_cat,y=..count../sum(..count..)*100)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
scale_x_discrete(limits=c("Begin","Middle","End")) +
  labs(x="Date_cat", y="Percent(%)") + labs(title="C1_1.Incident Date (Pre,%)")

plot_Date_cat_lock <- ggplot(data=Robbery_lock, aes(x=Date_cat,y=..count../sum(..count..)*100)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
scale_x_discrete(limits=c("Begin","Middle","End")) +
  labs(x="Date_cat", y="Percent(%)") + labs(title="C1_2.Incident Date (Lock,%)")

plot_Date_cat_post <- ggplot(data=Robbery_post, aes(x=Date_cat,y=..count../sum(..count..)*100)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
scale_x_discrete(limits=c("Begin","Middle","End")) +
  labs(x="Date_cat", y="Percent(%)") + labs(title="C1_3.Incident Date (Post,%)")

grid.arrange(plot_Date_cat, plot_Date_cat_pre, plot_Date_cat_lock, plot_Date_cat_post,
             ncol=2, nrow=2)

```

**4-2. Boxplot distribution of date :split by pandemic phrases**

```{r}
boxplot_Date <- ggplot(Robbery, aes(y=Date, x=Period_cat, fill=Period_cat)) + 
  geom_boxplot() + 
  geom_boxplot( colour=c("#ff0000","#11cc11","#0000ff"), outlier.shape=8,
                outlier.colour="lightblue", outlier.size=4) +  labs(title="C1_4.Box Pot of Date of Robbery", x="Period", y = "Robbery date") + ylim(0,32)

boxplot_Date 
```

**5-1. Freq by SHIFT(DAY,EVENING,MIDNIGHT) :split by pandemic phrases**
 
```{r}
# Bar plot 

plot_SHIFT <- ggplot(data=Robbery, aes(x=SHIFT)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) +
  labs(x="Timezone") + labs(title="D1.Incident timezone")

plot_SHIFT_pre <- ggplot(data=Robbery_pre, aes(SHIFT)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) +
  labs(x="Timezone") + labs(title="D1_1.Incident timezone (Pre)")

plot_SHIFT_lock <- ggplot(data=Robbery_lock, aes(SHIFT)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) +
  labs(x="Timezone") + labs(title="D1_2.Incident timezone (Lock)")

plot_SHIFT_post <- ggplot(data=Robbery_post, aes(SHIFT)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) +
  labs(x="Timezone") + labs(title="D1_3.Incident timezone (Post)")

grid.arrange(plot_SHIFT, plot_SHIFT_pre, plot_SHIFT_lock, plot_SHIFT_post,
             ncol=2, nrow=2)

```

[Percent,%] Freq by SHIFT(DAY,EVENING,MIDNIGHT) :split by pandemic phrases

  + Portion of Day (Pre-Lock-Post): 18.4%	19.9%	21.1%
  + Portion of EVENING (Pre-Lock-Post): 40.4%	38.6%	39.8%
  + Portion of MIDNIGHT (Pre-Lock-Post): 41.2%	41.5%	39.1%

```{r}
# Bar plot 

plot_SHIFT <- ggplot(data=Robbery, aes(x=SHIFT,y=..count../sum(..count..)*100)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) +
  labs(x="Timezone", y="Percent(%)") + labs(title="D1.Incident timezone(%)")


plot_SHIFT_pre <- ggplot(data=Robbery_pre, aes(x=SHIFT,y=..count../sum(..count..)*100)) + geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) +
  labs(x="Timezone", y="Percent(%)") + labs(title="D1_1.Incident timezone (Pre,%)")

plot_SHIFT_lock <- ggplot(data=Robbery_lock, aes(x=SHIFT,y=..count../sum(..count..)*100)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) +
  labs(x="Timezone", y="Percent(%)") + labs(title="D1_2.Incident timezone (Lock,%)")

plot_SHIFT_post <- ggplot(data=Robbery_post, aes(x=SHIFT,y=..count../sum(..count..)*100)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
scale_x_discrete(limits=c("DAY","EVENING","MIDNIGHT")) +
  labs(x="Timezone", y="Percent(%)") + labs(title="D1_3.Incident timezone (Post,%)")

grid.arrange(plot_SHIFT, plot_SHIFT_pre, plot_SHIFT_lock, plot_SHIFT_post,
             ncol=2, nrow=2)

```

**5-2. Boxplot distribution of Time_hour(00:00~24:00) :split by pandemic phrases**


```{r}
boxplot_Time_hour <- ggplot(Robbery, aes(y=Time_hour, x=Period_cat, fill=Period_cat)) + 
  geom_boxplot() + 
  geom_boxplot( colour=c("#ff0000","#11cc11","#0000ff"), outlier.shape=8,
                outlier.colour="lightblue", outlier.size=4) +  labs(title="D1_4.Box Plot of Time_hour of Robbery", x="Period", y = "Robbery Time_hour") + ylim(0,23)

boxplot_Time_hour
```


**6-1. Freq by Day_cat (Sun~Sat) :split by pandemic phrases**
 
  + TBD

```{r}
# Bar plot 

plot_Day_cat<- ggplot(data=Robbery, aes(x=Day_cat)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("Sun","Mon","Tue","Wed","Thur","Fri","Sat")) +
  labs(x="Day") + labs(title="E1.Incident Date of Robbery")

plot_Day_cat_pre <- ggplot(data=Robbery_pre, aes(Day_cat)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("Mon","Tue","Wed","Thur","Fri","Sat","Sun")) +
  labs(x="Day") + labs(title="E1_1.Incident Date (Pre)")

plot_Day_cat_lock <- ggplot(data=Robbery_lock, aes(Day_cat)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("Mon","Tue","Wed","Thur","Fri","Sat","Sun")) +
  labs(x="Day") + labs(title="E1_2.Incident Date (Lock)")

plot_Day_cat_post <- ggplot(data=Robbery_post, aes(Day_cat)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + scale_x_discrete(limits=c("Mon","Tue","Wed","Thur","Fri","Sat","Sun")) +
  labs(x="Day") + labs(title="E1_3.Incident Date (Post)")

grid.arrange(plot_Day_cat, plot_Day_cat_pre, plot_Day_cat_lock, plot_Day_cat_post,
             ncol=2, nrow=2)

```

**7-1. Freq by Day_cat_2 (Week,Weekend) :split by pandemic phrases**

  + Portion of Weekend (Pre-Lock-Post): 31.01%	32.25%	31.21%

```{r}
# Bar plot 

plot_Day_cat_2<- ggplot(data=Robbery, aes(x=Day_cat_2)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="Day") +
  labs(title="F1.Incident Date_2 of Robbery")

plot_Day_cat_2_pre <- ggplot(data=Robbery_pre, aes(Day_cat_2)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) +labs(x="Day") +
  labs(title="F1_1.Incident Date_2 (Pre)")

plot_Day_cat_2_lock <- ggplot(data=Robbery_lock, aes(Day_cat_2)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="Day") +
  labs(title="F1_2.Incident Date_2 (Lock)")

plot_Day_cat_2_post <- ggplot(data=Robbery_post, aes(Day_cat_2)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="Day") +
  labs(title="F1_3.Incident Date_2 (Post)")

grid.arrange(plot_Day_cat_2, plot_Day_cat_2_pre, plot_Day_cat_2_lock, plot_Day_cat_2_post,
             ncol=2, nrow=2)

```


**8-1. Freq by METHOD :split by pandemic phrases**

  + Portion of Gun (Pre-Lock-Post): 34.24%	51.67%	56.93%
  + Avg.freq(per month) of Gun robbery(Pre-Lock-Post) :  62  83(+34%) 103(+24%) 

```{r}
# Bar plot 

plot_METHOD<- ggplot(data=Robbery, aes(x=METHOD)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="METHOD") +
  labs(title="G1.Incident Date_2 of Robbery")

plot_METHOD_pre <- ggplot(data=Robbery_pre, aes(METHOD)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) +labs(x="METHOD") +
  labs(title="G1_1.Incident Date_2 (Pre)")

plot_METHOD_lock <- ggplot(data=Robbery_lock, aes(METHOD)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="METHOD") +
  labs(title="G1_2.Incident Date_2 (Lock)")

plot_METHOD_post <- ggplot(data=Robbery_post, aes(METHOD)) + 
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="METHOD") +
  labs(title="G1_3.Incident Date_2 (Post)")

grid.arrange(plot_METHOD, plot_METHOD_pre, plot_METHOD_lock, plot_METHOD_post,
             ncol=2, nrow=2)

```

**9-1. Freq by DISTRICT :split by pandemic phrases**

  + During lockdown, robbery of DISTRICT2 and 3 drmatically decreased.
  + However, robbery of DISTRICT5~7 even increased.
  + Portion of DISTRICT 5 (Pre-Lock-Post): 14.24%	16.01%	15.33%
  + Portion of DISTRICT 6 (Pre-Lock-Post): 17.12%	22.13%	20.01%
  + Portion of DISTRICT 7 (Pre-Lock-Post): 11.99%	15.28%	12.60%


```{r}
# Bar plot 

plot_DISTRICT<- ggplot(data=Robbery, aes(x=DISTRICT)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="DISTRICT") + scale_x_discrete(limits=c("1","2","3","4","5","6","7","NA")) + 
  labs(title="H1.Robbery BY DISTRICT")


plot_DISTRICT_pre<- ggplot(data=Robbery_pre, aes(x=DISTRICT)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="DISTRICT") + scale_x_discrete(limits=c("1","2","3","4","5","6","7","NA")) + 
  labs(title="H1_1.Robbery BY DISTRICT (Pre)")

plot_DISTRICT_lock<- ggplot(data=Robbery_lock, aes(x=DISTRICT)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="DISTRICT") + scale_x_discrete(limits=c("1","2","3","4","5","6","7","NA")) + 
  labs(title="H1_2.Robbery BY DISTRICT (Lock)")

plot_DISTRICT_post<- ggplot(data=Robbery_post, aes(x=DISTRICT)) +
geom_bar(colour="darkblue", fill="lightblue",alpha = .7) +
geom_text(stat='count', aes(label=..count..),vjust = 1.5) + labs(x="DISTRICT") + scale_x_discrete(limits=c("1","2","3","4","5","6","7","NA")) + 
  labs(title="H1_3.Robbery BY DISTRICT (Post)")

grid.arrange(plot_DISTRICT, plot_DISTRICT_pre, plot_DISTRICT_lock, plot_DISTRICT_post,ncol=2, nrow=2)

```

**10-1. Boxplot distribution of PSA :split by pandemic phrases**

  + Boxplot also reveals robbery of DISTRICT5~7 steeply increased.

```{r}
boxplot_PSA <- ggplot(Robbery, aes(y=PSA, x=Period_cat, fill=Period_cat)) + 
  geom_boxplot() + 
  geom_boxplot( colour=c("#ff0000","#11cc11","#0000ff"), outlier.shape=8,
                outlier.colour="lightblue", outlier.size=4) +  labs(title="I_1. Box Plot of Robbery by Location(PSA)", x="Period", y = "Location (PSA) of Robbery")

boxplot_PSA
```

**10-2. Boxplot distribution of Clearance rate :split by pandemic phrases**

  + During the lock-down, the number of outlier increased.
  + High Clearance rate(need more time to complete robbery event)
    implies hard/severe event or inefficiency of police administration

```{r}
boxplot_Clearance <- ggplot(Robbery, aes(y=Clearance_rate, x=Period_cat, fill=Period_cat)) + 
  geom_boxplot() + 
  geom_boxplot( colour=c("#ff0000","#11cc11","#0000ff"), outlier.shape=8,
                outlier.colour="lightblue", outlier.size=4) +  labs(title="I_2. Box Plot of Robbery Clearance rate", x="Period", y = "Clearance_rate(Minute)")

boxplot_Clearance
```

### 3. Unusual Observations: Data Quality

In the "Unusual Observations" section, we will provide an in-depth analysis of the data, including a quick overview of the data with and without the outliers. Outliers can significantly impact the analysis of data and can skew the results. Therefore, it is crucial to identify and examine them closely to determine their impact on the data.By examining the data with and without the outliers, we can gain a clearer picture of the trends and patterns in the data. This information will be critical in developing an accurate and reliable analysis of the impact of the COVID-19 lockdown on robbery rates in Washington D.C.


**Data Quality**
To ensure data quality, we will perform the outlierKD function to detect any null values or outliers in our dataset. Once identified, we will remove them to ensure accurate analysis. We will then display the cleaned data using a plot to visualize any trends or patterns in the data.

`OBJECTID` : there is no outlier 

```{r}
Robbery_clean = outlierKD2(Robbery, OBJECTID, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
 
```

Continue to perform test for another continuous variables. 

 + Variables that have Fixed interval like `Date`, `Time_hour` don't need test     
   So Just do that about two variables `Clearance_rate` and `PSA`

`PSA` : there is no outlier

```{r}

Robbery_clean = outlierKD2(Robbery, PSA, rm = TRUE, boxplt = TRUE, qqplt = TRUE)

```   
`Clearance_rate` shows highly spread-wide, so need to consider excluding outliers.

 + Outliers that have high clearance_rate was converted to NA (4.8%)    
 + We will use both data (original and outlier excluded data)

```{r}
Robbery_clean = outlierKD2(Robbery, Clearance_rate, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
#str(Robbery_clean)
```
After examining the data using the outlierKD function, we have identified outliers that have been replaced with NAs. However, we have not deleted these outliers from the dataset. Instead, we have replaced them with NAs to ensure that they do not affect the analysis of the data. This approach allows us to retain the maximum amount of data while still removing any data points that may negatively impact our analysis

### Optional analysis(For subset data have high clearance_rate)

FOr example, looking through the obs that have long clearance rate (over 200 min). Interesting thing is distict 3,7. (let's talk about that at the meeting!)

```{r}
#Clearance_rate

temp <- subset(Robbery,subset = Robbery$Clearance_rate > 200) 
str(temp)  #361


```

```{r}
temp %>%  #Freq of Char
  count(Period_cat)

temp %>%  
  count(Date_cat)

temp %>%  
  count(Day_cat_2)

temp %>%  
  count(SHIFT)

temp %>%  
  count(METHOD)

temp %>%  
  count(DISTRICT)

#temp %>%  
#  count(PSA)


```

# (Dataset) Before moving on to the Hypothesis test
 
 1. Currently, we have 5 datasets. (2 total, 3 subsets)

  + original: Robbery, pre, lock, post
  + outlier excluded data: Robbery_clean

 2. Additionally, we will make 5 summary datasets for advanced analysis like hypothesis test
 
  + (Sum of frequency, origin from Robbery_clean) 
    Robbery_date_sum, Robbery_month_sum, Robbery_Date_cat_sum
    
  + (Average of clearance_rate) 
    Robbery_district_avg_clr (origin from both Robbery),
    Robbery_clean_district_avg_clr (origin from Robbery_clean)


**# 2. Make the 5 summary datasets and Load **

  + (Summary of frequency, origin for Robbery_clean) 
    Robbery_date_sum, Robbery_month_sum, Robbery_Date_cat_sum

  + (Summary of clearance_rate, origin for both Robbery and Robbery_clean) 
    Robbery_district_avg_clr, Robbery_clean_district_avg_clr


```{r, results='hide'}
# This block will run/execute but just skip showing result

temp <- select(Robbery_clean,REPORT_DAT_2,Period_cat)
  
Robbery_date_sum <- count(temp,REPORT_DAT_2,Period_cat, sort=FALSE)
#str(Robbery_date_sum)
arrange(Robbery_date_sum, REPORT_DAT_2)  #Ascending
#head(Robbery_date_sum,5)  
```


*The first 4 rows of the first summary dataset (Robbery_date_sum) are:*

```{r}

xkabledply(Robbery_date_sum[1:4,], title = "First Four Rows of Dataframe: `Robbery_date_sum`")

```


```{r,results='hide'}
temp <- select(Robbery_clean,Month_3,Period_cat)
  
Robbery_month_sum <- count(temp,Month_3,Period_cat, sort=FALSE)
#str(Robbery_date_sum)
arrange(Robbery_month_sum, Month_3)  #Ascending
#head(Robbery_date_sum,10)  
```


*The first 4 rows of the second summary dataset (Robbery_month_sum) are:*

```{r}

xkabledply(Robbery_month_sum[1:4,], title = "First Four Rows of Dataframe: `Robbery_month_sum`")

```

```{r,results='hide'}
temp <- select(Robbery_clean,Date_cat,Period_cat)
  
Robbery_Date_cat_sum <- count(temp,Date_cat,Period_cat, sort=FALSE)
#str(Robbery_date_sum)
arrange(Robbery_Date_cat_sum, Date_cat,Period_cat)  #Ascending
#head(Robbery_date_sum,10)  
```

*The third summary dataset (Robbery_Date_cat_sum) are:*

```{r}

xkabledply(Robbery_Date_cat_sum, title = "Dataframe: `Robbery_Date_cat_sum`")

```


```{r,results='hide'}
Robbery_district_avg_clr <-  Robbery %>% group_by(Period_cat, DISTRICT) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_district_avg_clr, Period_cat,DISTRICT) 

Robbery_district_avg_clr <- data.frame(Robbery_district_avg_clr)

```

*The first 4 rows of the fourth summary dataset (Robbery_district_avg_clr) are:*
  + Robbery_district_avg_clr: origin for **Robbery**

```{r}

xkabledply(Robbery_district_avg_clr[1:4,], title = "Dataframe: `Robbery_district_avg_clr`")

```


```{r,results='hide'}
Robbery_clean_district_avg_clr <-  Robbery_clean %>% group_by(Period_cat, DISTRICT) %>%
                   summarise(avg_Clearance_rate = mean(Clearance_rate, na.rm = TRUE),.groups = 'drop')

arrange(Robbery_clean_district_avg_clr, Period_cat,DISTRICT) 

Robbery_clean_district_avg_clr <- data.frame(Robbery_clean_district_avg_clr)

```

*The first 4 rows of the fifth summary dataset (Robbery_clean_district_avg_clr) are:*
  + Robbery_clean_district_avg_clr: origin for **Robbery_clean (outlier excluded)**

```{r}

xkabledply(Robbery_clean_district_avg_clr[1:4,], title = "Dataframe: `Robbery_district_avg_clr`")

```
#Wrap-up final datasets Save (Begin next step by loading these data)

 1. Main datasets: 5 (2 total, 3 subsets)

  + original: Robbery, pre, lock, post
  + outlier excluded data: Robbery_clean

 2. Summary datasets: 5 
 
  + (Sum of frequency, origin from Robbery_clean) 
    Robbery_date_sum, Robbery_month_sum, Robbery_Date_cat_sum
    
  + (Average of clearance_rate) 
    Robbery_district_avg_clr (origin from both Robbery),
    Robbery_clean_district_avg_clr (origin from Robbery_clean)



**# 1. Save the 5 Main current datasets(Mar 3)/ and Load **


```{r}
#Save current data
#readr::write_rds(Robbery, "Robbery_230303.Rds")
#readr::write_rds(Robbery_pre, "Robbery_pre_230303.Rds")
#readr::write_rds(Robbery_lock, "Robbery_lock_230303.Rds")
#readr::write_rds(Robbery_post, "Robbery_post_230303.Rds")
#readr::write_rds(Robbery_clean, "Robbery_clean_230303.Rds")

#Use this code to load
Robbery <- 
  readr::read_rds("Robbery_230303.Rds")

Robbery_clean <- 
  readr::read_rds("Robbery_clean_230303.Rds")

#Load subset
Robbery_pre <- 
  readr::read_rds("Robbery_pre_230303.Rds")

Robbery_lock <- 
  readr::read_rds("Robbery_lock_230303.Rds")

Robbery_post <- 
  readr::read_rds("Robbery_post_230303.Rds")

```


Verify again before moving on the next step

```{r}
#str(Robbery)
#str(Robbery_pre)
#str(Robbery_lock)
#str(Robbery_post)
#str(Robbery_clean)
#head(Robbery,10)  
```


**# 2. Save the 5 Summary datasets(Mar 3)/ and Load **

```{r}
#Save current data
#readr::write_rds(Robbery_date_sum, "Robbery_date_sum_230303.Rds")
#readr::write_rds(Robbery_month_sum, "Robbery_month_sum_230303.Rds")
#readr::write_rds(Robbery_Date_cat_sum, "Robbery_Date_cat_sum_230303.Rds")
#readr::write_rds(Robbery_district_avg_clr, "Robbery_district_avg_clr_230303.Rds")
#readr::write_rds(Robbery_clean_district_avg_clr, "Robbery_clean_district_avg_clr_230303.Rds")

#Use this code to load
Robbery_date_sum <- 
  readr::read_rds("Robbery_date_sum_230303.Rds")

Robbery_month_sum <- 
  readr::read_rds("Robbery_month_sum_230303.Rds")

Robbery_Date_cat_sum <- 
  readr::read_rds("Robbery_Date_cat_sum_230303.Rds")

Robbery_district_avg_clr <- 
  readr::read_rds("Robbery_district_avg_clr_230303.Rds")

Robbery_clean_district_avg_clr <- 
  readr::read_rds("Robbery_clean_district_avg_clr_230303.Rds")

```


Verify again before moving on the next step

```{r}
#str(Robbery_date_sum)
#str(Robbery_month_sum)
#str(Robbery_Date_cat_sum)
#str(Robbery_district_avg_clr)
#str(Robbery_clean_district_avg_clr)

```

#Hypothesis test

**Maybe we additionally need to draw Sccater plot, Normality Test etc.


**Anova test**


```{r}
anova_robbery_per_day = aov(avg_Clearance_rate~DISTRICT, data = Robbery_district_avg_clr)
xkabledply(anova_robbery_per_day, title = "anova_gre result summary")
```


**Chi-squared Test**
```{r}
table1 = table(Robbery$Period_cat, Robbery$SHIFT)
xkabledply(table1, title="Contingency table 1'")
chitest1 <- chisq.test(table1)
chitest1
```



```{r}
table2 = table(Robbery$Period_cat, Robbery$Season)
xkabledply(table2, title="Contingency table 2'")
chitest2 = chisq.test(table2)
chitest2
```


```{r}
table3 = table(Robbery$Period_cat, Robbery$Day_cat_2)
xkabledply(table3, title="Contingency table 3'")
chitest3 = chisq.test(table3)
chitest3
```



```{r}
table4 = table(Robbery$Period_cat, Robbery$METHOD)
xkabledply(table4, title="Contingency table4'")
chitest4 = chisq.test(table4)
chitest4
```

```{r}
table5 = table(Robbery$Period_cat, Robbery$Month)
xkabledply(table5, title="Contingency table 5'")
chitest5 = chisq.test(table5)
chitest5
```

```{r}
table6 = table(Robbery$Period_cat, Robbery$DISTRICT)
xkabledply(table6, title="Contingency table 6'")
chitest6 = chisq.test(table6)
chitest6
```

##   Discussion 






## Conclusion







## References 



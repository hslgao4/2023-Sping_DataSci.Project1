---
title: "The Impact of COVID-19 Lockdown on Robbery Rates: An Exploratory Data Analysis (EDA) of Criminal Activity in Washington D.C."
author: "Muhannad Alwhebie, Liang Gao, Nammin Woo"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=F}
#nammin revise: add library options
library(ezids)
library(readr) #install & load 
library(ggplot2)
library(DBI) #SQL
library(magrittr)
library(dplyr)  #for data manipulation.
library(tidyr) #for data tidying.
library(tidyverse)
library(graphics) 
library(gridExtra) #graph arrange(positioning)
```

```{r setup, include=FALSE}
#nammin revise: knitr::opts_chunk$set(echo = TRUE) > combined as following
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
options(scipen=9999, digits = 3) 
#options(scientific=T, digits = 3) 
#options(scipen = 9999) # suppress scientific notation
```


# The Effect of COVID-19 Lockdown on Robbery Incidents in Washington D.C.

## Abstract

## Introduction

**Summary of initial project 1**

**SMART questions of project 2**

What should police predict when receiving calls from victims?

1. What if police could predict dangerous robberies (used "GUN") based on information that were gathered at the beginning?   
2. What if police could forecast how tricky the robberies would be(need longer time to clear) before being dispatched?
3.  What if police could forecast whether the dangerous distircts is?



## Methodology



### 1. Data sourcing

Load the lastest data in project 1. The outliers of clearance_rate have been removed (converted into NA) in Robbery_clean.

```{r}
#
#1. Robbery_230303.Rds: original
#2. Robbery_clean_230303.Rds : outlier transformed to NA

#Use this code to load
Robbery <- 
  readr::read_rds("Robbery_230303.Rds")

Robbery_clean <- 
  readr::read_rds("Robbery_clean_230303.Rds")


#Export again into csv (for addon some keyvalue for census track)
#write.csv(Robbery_clean, "Robbery_clean.csv", row.names=FALSE)
#write.csv(Robbery, "Robbery.csv", row.names=FALSE)
```

To delve into predictive modeling, we dicided to add a few new features that come from census bureau. 

```{r}
#Import
Robbery_clean_p2 = data.frame(read.csv("Robbery_clean_p2.csv"))
Robbery_p2 = data.frame(read.csv("Robbery_p2.csv"))
Census_eco = data.frame(read.csv("ACS_Economic_Census_clean.csv"))

#Import
#str(Robbery)  
```


```{r}
str(Robbery_clean_p2)
#colnames(Robbery)
#ncol(Robbery)
#nrow(Robbery)
```


ACS Economic Characteristics DC Census Tract
the most current release of data from the American Community Survey (ACS) about economic characteristics. These are 5-year estimates shown by 2020 Census Tract boundaries.(Employment, Commuting, Occupation, Income, Health Insurance, Poverty,etc.)

```{r}
str(Census_eco)
```

```{r}
#columns that are necessary to anaysis
#ex_cols <- c('OBJECTID','STATEFP','COUNTYFP','CENSUS_TRACT','GEOID')
temp <- select(Census_eco,-OBJECTID,-STATEFP,-COUNTYFP,-CENSUS_TRACT,-GEOID)

knitr::kable(temp, format = "markdown", caption="Overall summary statistics of DC Census Tract(Economic Characteristics)")

```

Aggregate census bureau data to the orginal dataset.

```{r}
#Add new features joining with key
temp <- select(Census_eco,-OBJECTID,-STATEFP,-COUNTYFP,-GEOID)
Robbery_clean_p2_add <- merge(x = Robbery_clean_p2, y = temp, by = "CENSUS_TRACT", all.x = TRUE)
```

```{r}
str(Robbery_clean_p2)
str(Robbery_clean_p2_add)
```
```{r}
nrow(Robbery_clean_p2)
nrow(Robbery_clean_p2_add)
```


```{r}
ncol(Robbery_clean_p2)
ncol(Census_eco)-5
ncol(Robbery_clean_p2_add)

```
```{r}
head(Robbery_clean_p2_add,5) 
```

### 2. Define target variables

Define three target variables. 


1. Target_Clearance_time: whether Longer time (over 85 min, 75% quantile) or not 
2. Target_robbery_method: Gun or other
3. Target_district: whether dangerous distirict(6,7) or not


```{r}
#Summary
#columns to analyse 
cols <- c('Clearance_rate','METHOD','DISTRICT')
#summary(select(Robbery,cols))
summary(select(Robbery_clean_p2_add,cols))        
#knitr::kable(summary(select(Robbery,cols)), format = "markdown", caption="Summary #statistics of Robbery between 2019 to 2022 in D.C")

```

1. Target_Clearance_time: whether Longer time (over 85 min, 75% quantile) or not

```{r}
#Create target vars with Conditional statement
#Clearance_rate METHOD DISTRICT

# 1
Robbery_clean_p2_add$Target_Clearance_time <- ifelse(Robbery_clean_p2_add$Clearance_rate >= 85,
c(1), c(0))

# another example: create 3 age categories
#attach(mydata)
#mydata$agecat[age > 75] <- "Elder"
#mydata$agecat[age > 45 & age <= 75] <- "Middle Aged"
#mydata$agecat[age <= 45] <- "Young"
#detach(mydata)
#paste(dat[,1], dat[,2]

```

Consider trials for binary classification (1 is priority, then let's remove outliers NA)
1. predict Target_Clearance_time=1 : whether time is longer than 85 min(w.o outliers)
2. predict Target_Clearance_time=1 or NA (include NA into 1)
3. predict Target_Clearance_time=NA : whether time is extemely long.

```{r}
count(Robbery_clean_p2_add,Target_Clearance_time, sort=FALSE)
```

2. Target_robbery_method: Gun or other

```{r}
# 1
Robbery_clean_p2_add$Target_robbery_method <- ifelse(Robbery_clean_p2_add$METHOD == 'GUN',c(1), c(0))

```

```{r}
count(Robbery_clean_p2_add,Target_robbery_method, sort=FALSE)
```

3. Target_district: whether dangerous district(6,7) or not

```{r}
# 1
Robbery_clean_p2_add$Target_district <- ifelse(Robbery_clean_p2_add$DISTRICT>=6,c(1), c(0))

```

```{r}
count(Robbery_clean_p2_add,Target_district, sort=FALSE)
```

```{r}
#Dataframe Save and load
readr::write_rds(Robbery_clean_p2_add, "Robbery_clean_p2_add.Rds")
#Robbery_clean_p2_add <- 
  readr::read_rds("Robbery_clean_p2_add.Rds")
```


### 3. EDA for predictive modeling 
 target)
 - Correlation
 - Scatter charts w target, independent vars
 -

Pre-processing: finalize target and train data (about NAs of clearance,district

```{r}
df <-  subset(Robbery_clean_p2_add, Target_Clearance_time == 0 |Target_Clearance_time == 1)

nrow(df)
#NA: extremely long time is long time (or remove all NAs from data)
#Robbery_clean_p2_add$Target_Clearance_time(is.na(Robbery_clean_p2_add$Target_Clearanc#e_time))=1

```

```{r}
#NA: don't know, it might not be 6 or 7
Robbery_clean_p2_add$Target_district(is.na(Robbery_clean_p2_add$Target_district))=0
```











### 3. Model building techniques  
- Train/Test
- Modeling: 
Logistic regression
Decision tree
- Evaluation

*The variables in the dataset are:*

## Analysis 

### 1. 

## Conclusion

## References 
